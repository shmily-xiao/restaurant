{"version":3,"sources":["utils/wxParse/showdown.js"],"names":["getDefaultOpts","simple","defaultOptions","omitExtraWLInCodeBlocks","defaultValue","describe","type","noHeaderId","prefixHeaderId","headerLevelStart","parseImgDimensions","simplifiedAutoLink","literalMidWordUnderscores","strikethrough","tables","tablesHeaderId","ghCodeBlocks","tasklists","smoothLivePreview","smartIndentationFix","description","JSON","parse","stringify","ret","opt","hasOwnProperty","showdown","parsers","extensions","globalOptions","flavor","github","vanilla","helper","setOption","key","value","getOption","getOptions","resetOptions","setFlavor","name","preset","option","getDefaultOptions","subParser","func","isString","Error","extension","ext","stdExtName","isUndefined","isArray","validExtension","validate","valid","error","getAllExtensions","removeExtension","resetExtensions","errMsg","i","length","baseMsg","toLowerCase","listeners","filter","regex","ln","RegExp","replace","validateExtension","console","warn","a","String","isFunction","getType","toString","call","forEach","obj","callback","constructor","Array","s","escapeCharactersCallback","wholeMatch","m1","charCodeToEscape","charCodeAt","escapeCharacters","text","charsToEscape","afterBackslash","regexString","rgxFindMatchPos","str","left","right","flags","f","g","indexOf","x","l","pos","t","m","start","end","exec","test","lastIndex","index","match","push","matchRecursiveRegExp","matchPos","results","slice","replaceRecursiveRegExp","replacement","repStr","finalStr","lng","bits","join","msg","alert","log","Converter","converterOptions","options","langExtensions","outputModifiers","_constructor","gOpt","_parseExtension","legacyExtensionLoading","validExt","listen","rTrimInputText","rsp","rgx","_dispatch","dispatch","evtName","globals","ei","nText","makeHtml","gHtmlBlocks","gHtmlMdBlocks","gHtmlSpans","gUrls","gTitles","gDimensions","gListLevel","hashLinkCounts","converter","addExtension","useExtension","extensionName","splice","ii","language","output","writeAnchorTag","m2","m3","m4","m5","m6","m7","linkText","linkId","url","title","search","result","simpleURLRegex","delimUrlRegex","simpleMailRegex","delimMailRegex","replaceLink","replaceMail","wm","link","lnkTxt","unescapedStr","bq","pre","pattern","codeblock","nextChar","c","leadingText","numSpaces","addr","encode","ch","Math","floor","random","r","tag","blockText","blockTags","repFunc","txt","config","matches","prefixHeader","isNaN","parseInt","setextRegexH1","setextRegexH2","spanGamut","hID","headerId","hLevel","hashBlock","matchFound","span","header","escapedId","inlineRegExp","referenceRegExp","writeImageTag","altText","width","height","gDims","processListItems","listStr","trimTrailing","isParagraphed","taskbtn","checked","trim","item","bulletStyle","otp","parseConsecutiveLists","list","listType","counterRxg","subLists","parseCL","wholeList","grafs","split","grafsOut","grafsOutIt","codeFlag","delim","$1","num","$2","re","blankLines","tableRgx","parseStyles","sLine","parseHeaders","style","id","tableHeaderId","parseCells","cell","subText","buildTable","headers","cells","tb","tblLgn","rawTable","tableLines","rawHeaders","map","rawStyles","rawCells","styles","shift","row","charCodeToReplace","fromCharCode","module","exports"],"mappings":"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","file":"showdown.js","sourcesContent":["/**\r\n * showdown: https://github.com/showdownjs/showdown\r\n * author: Di (微信小程序开发工程师)\r\n * organization: WeAppDev(微信小程序开发论坛)(http://weappdev.com)\r\n *               垂直微信小程序开发交流社区\r\n * github地址: https://github.com/icindy/wxParse\r\n * for: 微信小程序富文本解析\r\n * detail : http://weappdev.com/t/wxparse-alpha0-1-html-markdown/184\r\n */\r\n/*eslint-disable */\r\nfunction getDefaultOpts(simple) {\r\n  'use strict';\r\n\r\n  var defaultOptions = {\r\n    omitExtraWLInCodeBlocks: {\r\n      defaultValue: false,\r\n      describe: 'Omit the default extra whiteline added to code blocks',\r\n      type: 'boolean'\r\n    },\r\n    noHeaderId: {\r\n      defaultValue: false,\r\n      describe: 'Turn on/off generated header id',\r\n      type: 'boolean'\r\n    },\r\n    prefixHeaderId: {\r\n      defaultValue: false,\r\n      describe: 'Specify a prefix to generated header ids',\r\n      type: 'string'\r\n    },\r\n    headerLevelStart: {\r\n      defaultValue: false,\r\n      describe: 'The header blocks level start',\r\n      type: 'integer'\r\n    },\r\n    parseImgDimensions: {\r\n      defaultValue: false,\r\n      describe: 'Turn on/off image dimension parsing',\r\n      type: 'boolean'\r\n    },\r\n    simplifiedAutoLink: {\r\n      defaultValue: false,\r\n      describe: 'Turn on/off GFM autolink style',\r\n      type: 'boolean'\r\n    },\r\n    literalMidWordUnderscores: {\r\n      defaultValue: false,\r\n      describe: 'Parse midword underscores as literal underscores',\r\n      type: 'boolean'\r\n    },\r\n    strikethrough: {\r\n      defaultValue: false,\r\n      describe: 'Turn on/off strikethrough support',\r\n      type: 'boolean'\r\n    },\r\n    tables: {\r\n      defaultValue: false,\r\n      describe: 'Turn on/off tables support',\r\n      type: 'boolean'\r\n    },\r\n    tablesHeaderId: {\r\n      defaultValue: false,\r\n      describe: 'Add an id to table headers',\r\n      type: 'boolean'\r\n    },\r\n    ghCodeBlocks: {\r\n      defaultValue: true,\r\n      describe: 'Turn on/off GFM fenced code blocks support',\r\n      type: 'boolean'\r\n    },\r\n    tasklists: {\r\n      defaultValue: false,\r\n      describe: 'Turn on/off GFM tasklist support',\r\n      type: 'boolean'\r\n    },\r\n    smoothLivePreview: {\r\n      defaultValue: false,\r\n      describe: 'Prevents weird effects in live previews due to incomplete input',\r\n      type: 'boolean'\r\n    },\r\n    smartIndentationFix: {\r\n      defaultValue: false,\r\n      description: 'Tries to smartly fix identation in es6 strings',\r\n      type: 'boolean'\r\n    }\r\n  };\r\n  if (simple === false) {\r\n    return JSON.parse(JSON.stringify(defaultOptions));\r\n  }\r\n  var ret = {};\r\n  for (var opt in defaultOptions) {\r\n    if (defaultOptions.hasOwnProperty(opt)) {\r\n      ret[opt] = defaultOptions[opt].defaultValue;\r\n    }\r\n  }\r\n  return ret;\r\n}\r\n\r\n/**\r\n * Created by Tivie on 06-01-2015.\r\n */\r\n\r\n// Private properties\r\nvar showdown = {},\r\n    parsers = {},\r\n    extensions = {},\r\n    globalOptions = getDefaultOpts(true),\r\n    flavor = {\r\n      github: {\r\n        omitExtraWLInCodeBlocks:   true,\r\n        prefixHeaderId:            'user-content-',\r\n        simplifiedAutoLink:        true,\r\n        literalMidWordUnderscores: true,\r\n        strikethrough:             true,\r\n        tables:                    true,\r\n        tablesHeaderId:            true,\r\n        ghCodeBlocks:              true,\r\n        tasklists:                 true\r\n      },\r\n      vanilla: getDefaultOpts(true)\r\n    };\r\n\r\n/**\r\n * helper namespace\r\n * @type {{}}\r\n */\r\nshowdown.helper = {};\r\n\r\n/**\r\n * TODO LEGACY SUPPORT CODE\r\n * @type {{}}\r\n */\r\nshowdown.extensions = {};\r\n\r\n/**\r\n * Set a global option\r\n * @static\r\n * @param {string} key\r\n * @param {*} value\r\n * @returns {showdown}\r\n */\r\nshowdown.setOption = function (key, value) {\r\n  'use strict';\r\n  globalOptions[key] = value;\r\n  return this;\r\n};\r\n\r\n/**\r\n * Get a global option\r\n * @static\r\n * @param {string} key\r\n * @returns {*}\r\n */\r\nshowdown.getOption = function (key) {\r\n  'use strict';\r\n  return globalOptions[key];\r\n};\r\n\r\n/**\r\n * Get the global options\r\n * @static\r\n * @returns {{}}\r\n */\r\nshowdown.getOptions = function () {\r\n  'use strict';\r\n  return globalOptions;\r\n};\r\n\r\n/**\r\n * Reset global options to the default values\r\n * @static\r\n */\r\nshowdown.resetOptions = function () {\r\n  'use strict';\r\n  globalOptions = getDefaultOpts(true);\r\n};\r\n\r\n/**\r\n * Set the flavor showdown should use as default\r\n * @param {string} name\r\n */\r\nshowdown.setFlavor = function (name) {\r\n  'use strict';\r\n  if (flavor.hasOwnProperty(name)) {\r\n    var preset = flavor[name];\r\n    for (var option in preset) {\r\n      if (preset.hasOwnProperty(option)) {\r\n        globalOptions[option] = preset[option];\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Get the default options\r\n * @static\r\n * @param {boolean} [simple=true]\r\n * @returns {{}}\r\n */\r\nshowdown.getDefaultOptions = function (simple) {\r\n  'use strict';\r\n  return getDefaultOpts(simple);\r\n};\r\n\r\n/**\r\n * Get or set a subParser\r\n *\r\n * subParser(name)       - Get a registered subParser\r\n * subParser(name, func) - Register a subParser\r\n * @static\r\n * @param {string} name\r\n * @param {function} [func]\r\n * @returns {*}\r\n */\r\nshowdown.subParser = function (name, func) {\r\n  'use strict';\r\n  if (showdown.helper.isString(name)) {\r\n    if (typeof func !== 'undefined') {\r\n      parsers[name] = func;\r\n    } else {\r\n      if (parsers.hasOwnProperty(name)) {\r\n        return parsers[name];\r\n      } else {\r\n        throw Error('SubParser named ' + name + ' not registered!');\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Gets or registers an extension\r\n * @static\r\n * @param {string} name\r\n * @param {object|function=} ext\r\n * @returns {*}\r\n */\r\nshowdown.extension = function (name, ext) {\r\n  'use strict';\r\n\r\n  if (!showdown.helper.isString(name)) {\r\n    throw Error('Extension \\'name\\' must be a string');\r\n  }\r\n\r\n  name = showdown.helper.stdExtName(name);\r\n\r\n  // Getter\r\n  if (showdown.helper.isUndefined(ext)) {\r\n    if (!extensions.hasOwnProperty(name)) {\r\n      throw Error('Extension named ' + name + ' is not registered!');\r\n    }\r\n    return extensions[name];\r\n\r\n    // Setter\r\n  } else {\r\n    // Expand extension if it's wrapped in a function\r\n    if (typeof ext === 'function') {\r\n      ext = ext();\r\n    }\r\n\r\n    // Ensure extension is an array\r\n    if (!showdown.helper.isArray(ext)) {\r\n      ext = [ext];\r\n    }\r\n\r\n    var validExtension = validate(ext, name);\r\n\r\n    if (validExtension.valid) {\r\n      extensions[name] = ext;\r\n    } else {\r\n      throw Error(validExtension.error);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Gets all extensions registered\r\n * @returns {{}}\r\n */\r\nshowdown.getAllExtensions = function () {\r\n  'use strict';\r\n  return extensions;\r\n};\r\n\r\n/**\r\n * Remove an extension\r\n * @param {string} name\r\n */\r\nshowdown.removeExtension = function (name) {\r\n  'use strict';\r\n  delete extensions[name];\r\n};\r\n\r\n/**\r\n * Removes all extensions\r\n */\r\nshowdown.resetExtensions = function () {\r\n  'use strict';\r\n  extensions = {};\r\n};\r\n\r\n/**\r\n * Validate extension\r\n * @param {array} extension\r\n * @param {string} name\r\n * @returns {{valid: boolean, error: string}}\r\n */\r\nfunction validate(extension, name) {\r\n  'use strict';\r\n\r\n  var errMsg = (name) ? 'Error in ' + name + ' extension->' : 'Error in unnamed extension',\r\n    ret = {\r\n      valid: true,\r\n      error: ''\r\n    };\r\n\r\n  if (!showdown.helper.isArray(extension)) {\r\n    extension = [extension];\r\n  }\r\n\r\n  for (var i = 0; i < extension.length; ++i) {\r\n    var baseMsg = errMsg + ' sub-extension ' + i + ': ',\r\n        ext = extension[i];\r\n    if (typeof ext !== 'object') {\r\n      ret.valid = false;\r\n      ret.error = baseMsg + 'must be an object, but ' + typeof ext + ' given';\r\n      return ret;\r\n    }\r\n\r\n    if (!showdown.helper.isString(ext.type)) {\r\n      ret.valid = false;\r\n      ret.error = baseMsg + 'property \"type\" must be a string, but ' + typeof ext.type + ' given';\r\n      return ret;\r\n    }\r\n\r\n    var type = ext.type = ext.type.toLowerCase();\r\n\r\n    // normalize extension type\r\n    if (type === 'language') {\r\n      type = ext.type = 'lang';\r\n    }\r\n\r\n    if (type === 'html') {\r\n      type = ext.type = 'output';\r\n    }\r\n\r\n    if (type !== 'lang' && type !== 'output' && type !== 'listener') {\r\n      ret.valid = false;\r\n      ret.error = baseMsg + 'type ' + type + ' is not recognized. Valid values: \"lang/language\", \"output/html\" or \"listener\"';\r\n      return ret;\r\n    }\r\n\r\n    if (type === 'listener') {\r\n      if (showdown.helper.isUndefined(ext.listeners)) {\r\n        ret.valid = false;\r\n        ret.error = baseMsg + '. Extensions of type \"listener\" must have a property called \"listeners\"';\r\n        return ret;\r\n      }\r\n    } else {\r\n      if (showdown.helper.isUndefined(ext.filter) && showdown.helper.isUndefined(ext.regex)) {\r\n        ret.valid = false;\r\n        ret.error = baseMsg + type + ' extensions must define either a \"regex\" property or a \"filter\" method';\r\n        return ret;\r\n      }\r\n    }\r\n\r\n    if (ext.listeners) {\r\n      if (typeof ext.listeners !== 'object') {\r\n        ret.valid = false;\r\n        ret.error = baseMsg + '\"listeners\" property must be an object but ' + typeof ext.listeners + ' given';\r\n        return ret;\r\n      }\r\n      for (var ln in ext.listeners) {\r\n        if (ext.listeners.hasOwnProperty(ln)) {\r\n          if (typeof ext.listeners[ln] !== 'function') {\r\n            ret.valid = false;\r\n            ret.error = baseMsg + '\"listeners\" property must be an hash of [event name]: [callback]. listeners.' + ln +\r\n              ' must be a function but ' + typeof ext.listeners[ln] + ' given';\r\n            return ret;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (ext.filter) {\r\n      if (typeof ext.filter !== 'function') {\r\n        ret.valid = false;\r\n        ret.error = baseMsg + '\"filter\" must be a function, but ' + typeof ext.filter + ' given';\r\n        return ret;\r\n      }\r\n    } else if (ext.regex) {\r\n      if (showdown.helper.isString(ext.regex)) {\r\n        ext.regex = new RegExp(ext.regex, 'g');\r\n      }\r\n      if (!ext.regex instanceof RegExp) {\r\n        ret.valid = false;\r\n        ret.error = baseMsg + '\"regex\" property must either be a string or a RegExp object, but ' + typeof ext.regex + ' given';\r\n        return ret;\r\n      }\r\n      if (showdown.helper.isUndefined(ext.replace)) {\r\n        ret.valid = false;\r\n        ret.error = baseMsg + '\"regex\" extensions must implement a replace string or function';\r\n        return ret;\r\n      }\r\n    }\r\n  }\r\n  return ret;\r\n}\r\n\r\n/**\r\n * Validate extension\r\n * @param {object} ext\r\n * @returns {boolean}\r\n */\r\nshowdown.validateExtension = function (ext) {\r\n  'use strict';\r\n\r\n  var validateExtension = validate(ext, null);\r\n  if (!validateExtension.valid) {\r\n    console.warn(validateExtension.error);\r\n    return false;\r\n  }\r\n  return true;\r\n};\r\n\r\n/**\r\n * showdownjs helper functions\r\n */\r\n\r\nif (!showdown.hasOwnProperty('helper')) {\r\n  showdown.helper = {};\r\n}\r\n\r\n/**\r\n * Check if var is string\r\n * @static\r\n * @param {string} a\r\n * @returns {boolean}\r\n */\r\nshowdown.helper.isString = function isString(a) {\r\n  'use strict';\r\n  return (typeof a === 'string' || a instanceof String);\r\n};\r\n\r\n/**\r\n * Check if var is a function\r\n * @static\r\n * @param {string} a\r\n * @returns {boolean}\r\n */\r\nshowdown.helper.isFunction = function isFunction(a) {\r\n  'use strict';\r\n  var getType = {};\r\n  return a && getType.toString.call(a) === '[object Function]';\r\n};\r\n\r\n/**\r\n * ForEach helper function\r\n * @static\r\n * @param {*} obj\r\n * @param {function} callback\r\n */\r\nshowdown.helper.forEach = function forEach(obj, callback) {\r\n  'use strict';\r\n  if (typeof obj.forEach === 'function') {\r\n    obj.forEach(callback);\r\n  } else {\r\n    for (var i = 0; i < obj.length; i++) {\r\n      callback(obj[i], i, obj);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * isArray helper function\r\n * @static\r\n * @param {*} a\r\n * @returns {boolean}\r\n */\r\nshowdown.helper.isArray = function isArray(a) {\r\n  'use strict';\r\n  return a.constructor === Array;\r\n};\r\n\r\n/**\r\n * Check if value is undefined\r\n * @static\r\n * @param {*} value The value to check.\r\n * @returns {boolean} Returns `true` if `value` is `undefined`, else `false`.\r\n */\r\nshowdown.helper.isUndefined = function isUndefined(value) {\r\n  'use strict';\r\n  return typeof value === 'undefined';\r\n};\r\n\r\n/**\r\n * Standardidize extension name\r\n * @static\r\n * @param {string} s extension name\r\n * @returns {string}\r\n */\r\nshowdown.helper.stdExtName = function (s) {\r\n  'use strict';\r\n  return s.replace(/[_-]||\\s/g, '').toLowerCase();\r\n};\r\n\r\nfunction escapeCharactersCallback(wholeMatch, m1) {\r\n  'use strict';\r\n  var charCodeToEscape = m1.charCodeAt(0);\r\n  return '~E' + charCodeToEscape + 'E';\r\n}\r\n\r\n/**\r\n * Callback used to escape characters when passing through String.replace\r\n * @static\r\n * @param {string} wholeMatch\r\n * @param {string} m1\r\n * @returns {string}\r\n */\r\nshowdown.helper.escapeCharactersCallback = escapeCharactersCallback;\r\n\r\n/**\r\n * Escape characters in a string\r\n * @static\r\n * @param {string} text\r\n * @param {string} charsToEscape\r\n * @param {boolean} afterBackslash\r\n * @returns {XML|string|void|*}\r\n */\r\nshowdown.helper.escapeCharacters = function escapeCharacters(text, charsToEscape, afterBackslash) {\r\n  'use strict';\r\n  // First we have to escape the escape characters so that\r\n  // we can build a character class out of them\r\n  var regexString = '([' + charsToEscape.replace(/([\\[\\]\\\\])/g, '\\\\$1') + '])';\r\n\r\n  if (afterBackslash) {\r\n    regexString = '\\\\\\\\' + regexString;\r\n  }\r\n\r\n  var regex = new RegExp(regexString, 'g');\r\n  text = text.replace(regex, escapeCharactersCallback);\r\n\r\n  return text;\r\n};\r\n\r\nvar rgxFindMatchPos = function (str, left, right, flags) {\r\n  'use strict';\r\n  var f = flags || '',\r\n    g = f.indexOf('g') > -1,\r\n    x = new RegExp(left + '|' + right, 'g' + f.replace(/g/g, '')),\r\n    l = new RegExp(left, f.replace(/g/g, '')),\r\n    pos = [],\r\n    t, s, m, start, end;\r\n\r\n  do {\r\n    t = 0;\r\n    while ((m = x.exec(str))) {\r\n      if (l.test(m[0])) {\r\n        if (!(t++)) {\r\n          s = x.lastIndex;\r\n          start = s - m[0].length;\r\n        }\r\n      } else if (t) {\r\n        if (!--t) {\r\n          end = m.index + m[0].length;\r\n          var obj = {\r\n            left: {start: start, end: s},\r\n            match: {start: s, end: m.index},\r\n            right: {start: m.index, end: end},\r\n            wholeMatch: {start: start, end: end}\r\n          };\r\n          pos.push(obj);\r\n          if (!g) {\r\n            return pos;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  } while (t && (x.lastIndex = s));\r\n\r\n  return pos;\r\n};\r\n\r\n/**\r\n * matchRecursiveRegExp\r\n *\r\n * (c) 2007 Steven Levithan <stevenlevithan.com>\r\n * MIT License\r\n *\r\n * Accepts a string to search, a left and right format delimiter\r\n * as regex patterns, and optional regex flags. Returns an array\r\n * of matches, allowing nested instances of left/right delimiters.\r\n * Use the \"g\" flag to return all matches, otherwise only the\r\n * first is returned. Be careful to ensure that the left and\r\n * right format delimiters produce mutually exclusive matches.\r\n * Backreferences are not supported within the right delimiter\r\n * due to how it is internally combined with the left delimiter.\r\n * When matching strings whose format delimiters are unbalanced\r\n * to the left or right, the output is intentionally as a\r\n * conventional regex library with recursion support would\r\n * produce, e.g. \"<<x>\" and \"<x>>\" both produce [\"x\"] when using\r\n * \"<\" and \">\" as the delimiters (both strings contain a single,\r\n * balanced instance of \"<x>\").\r\n *\r\n * examples:\r\n * matchRecursiveRegExp(\"test\", \"\\\\(\", \"\\\\)\")\r\n * returns: []\r\n * matchRecursiveRegExp(\"<t<<e>><s>>t<>\", \"<\", \">\", \"g\")\r\n * returns: [\"t<<e>><s>\", \"\"]\r\n * matchRecursiveRegExp(\"<div id=\\\"x\\\">test</div>\", \"<div\\\\b[^>]*>\", \"</div>\", \"gi\")\r\n * returns: [\"test\"]\r\n */\r\nshowdown.helper.matchRecursiveRegExp = function (str, left, right, flags) {\r\n  'use strict';\r\n\r\n  var matchPos = rgxFindMatchPos (str, left, right, flags),\r\n    results = [];\r\n\r\n  for (var i = 0; i < matchPos.length; ++i) {\r\n    results.push([\r\n      str.slice(matchPos[i].wholeMatch.start, matchPos[i].wholeMatch.end),\r\n      str.slice(matchPos[i].match.start, matchPos[i].match.end),\r\n      str.slice(matchPos[i].left.start, matchPos[i].left.end),\r\n      str.slice(matchPos[i].right.start, matchPos[i].right.end)\r\n    ]);\r\n  }\r\n  return results;\r\n};\r\n\r\n/**\r\n *\r\n * @param {string} str\r\n * @param {string|function} replacement\r\n * @param {string} left\r\n * @param {string} right\r\n * @param {string} flags\r\n * @returns {string}\r\n */\r\nshowdown.helper.replaceRecursiveRegExp = function (str, replacement, left, right, flags) {\r\n  'use strict';\r\n\r\n  if (!showdown.helper.isFunction(replacement)) {\r\n    var repStr = replacement;\r\n    replacement = function () {\r\n      return repStr;\r\n    };\r\n  }\r\n\r\n  var matchPos = rgxFindMatchPos(str, left, right, flags),\r\n      finalStr = str,\r\n      lng = matchPos.length;\r\n\r\n  if (lng > 0) {\r\n    var bits = [];\r\n    if (matchPos[0].wholeMatch.start !== 0) {\r\n      bits.push(str.slice(0, matchPos[0].wholeMatch.start));\r\n    }\r\n    for (var i = 0; i < lng; ++i) {\r\n      bits.push(\r\n        replacement(\r\n          str.slice(matchPos[i].wholeMatch.start, matchPos[i].wholeMatch.end),\r\n          str.slice(matchPos[i].match.start, matchPos[i].match.end),\r\n          str.slice(matchPos[i].left.start, matchPos[i].left.end),\r\n          str.slice(matchPos[i].right.start, matchPos[i].right.end)\r\n        )\r\n      );\r\n      if (i < lng - 1) {\r\n        bits.push(str.slice(matchPos[i].wholeMatch.end, matchPos[i + 1].wholeMatch.start));\r\n      }\r\n    }\r\n    if (matchPos[lng - 1].wholeMatch.end < str.length) {\r\n      bits.push(str.slice(matchPos[lng - 1].wholeMatch.end));\r\n    }\r\n    finalStr = bits.join('');\r\n  }\r\n  return finalStr;\r\n};\r\n\r\n/**\r\n * POLYFILLS\r\n */\r\nif (showdown.helper.isUndefined(console)) {\r\n  console = {\r\n    warn: function (msg) {\r\n      'use strict';\r\n      alert(msg);\r\n    },\r\n    log: function (msg) {\r\n      'use strict';\r\n      alert(msg);\r\n    },\r\n    error: function (msg) {\r\n      'use strict';\r\n      throw msg;\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Created by Estevao on 31-05-2015.\r\n */\r\n\r\n/**\r\n * Showdown Converter class\r\n * @class\r\n * @param {object} [converterOptions]\r\n * @returns {Converter}\r\n */\r\nshowdown.Converter = function (converterOptions) {\r\n  'use strict';\r\n\r\n  var\r\n      /**\r\n       * Options used by this converter\r\n       * @private\r\n       * @type {{}}\r\n       */\r\n      options = {},\r\n\r\n      /**\r\n       * Language extensions used by this converter\r\n       * @private\r\n       * @type {Array}\r\n       */\r\n      langExtensions = [],\r\n\r\n      /**\r\n       * Output modifiers extensions used by this converter\r\n       * @private\r\n       * @type {Array}\r\n       */\r\n      outputModifiers = [],\r\n\r\n      /**\r\n       * Event listeners\r\n       * @private\r\n       * @type {{}}\r\n       */\r\n      listeners = {};\r\n\r\n  _constructor();\r\n\r\n  /**\r\n   * Converter constructor\r\n   * @private\r\n   */\r\n  function _constructor() {\r\n    converterOptions = converterOptions || {};\r\n\r\n    for (var gOpt in globalOptions) {\r\n      if (globalOptions.hasOwnProperty(gOpt)) {\r\n        options[gOpt] = globalOptions[gOpt];\r\n      }\r\n    }\r\n\r\n    // Merge options\r\n    if (typeof converterOptions === 'object') {\r\n      for (var opt in converterOptions) {\r\n        if (converterOptions.hasOwnProperty(opt)) {\r\n          options[opt] = converterOptions[opt];\r\n        }\r\n      }\r\n    } else {\r\n      throw Error('Converter expects the passed parameter to be an object, but ' + typeof converterOptions +\r\n      ' was passed instead.');\r\n    }\r\n\r\n    if (options.extensions) {\r\n      showdown.helper.forEach(options.extensions, _parseExtension);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Parse extension\r\n   * @param {*} ext\r\n   * @param {string} [name='']\r\n   * @private\r\n   */\r\n  function _parseExtension(ext, name) {\r\n\r\n    name = name || null;\r\n    // If it's a string, the extension was previously loaded\r\n    if (showdown.helper.isString(ext)) {\r\n      ext = showdown.helper.stdExtName(ext);\r\n      name = ext;\r\n\r\n      // LEGACY_SUPPORT CODE\r\n      if (showdown.extensions[ext]) {\r\n        console.warn('DEPRECATION WARNING: ' + ext + ' is an old extension that uses a deprecated loading method.' +\r\n          'Please inform the developer that the extension should be updated!');\r\n        legacyExtensionLoading(showdown.extensions[ext], ext);\r\n        return;\r\n      // END LEGACY SUPPORT CODE\r\n\r\n      } else if (!showdown.helper.isUndefined(extensions[ext])) {\r\n        ext = extensions[ext];\r\n\r\n      } else {\r\n        throw Error('Extension \"' + ext + '\" could not be loaded. It was either not found or is not a valid extension.');\r\n      }\r\n    }\r\n\r\n    if (typeof ext === 'function') {\r\n      ext = ext();\r\n    }\r\n\r\n    if (!showdown.helper.isArray(ext)) {\r\n      ext = [ext];\r\n    }\r\n\r\n    var validExt = validate(ext, name);\r\n    if (!validExt.valid) {\r\n      throw Error(validExt.error);\r\n    }\r\n\r\n    for (var i = 0; i < ext.length; ++i) {\r\n      switch (ext[i].type) {\r\n\r\n        case 'lang':\r\n          langExtensions.push(ext[i]);\r\n          break;\r\n\r\n        case 'output':\r\n          outputModifiers.push(ext[i]);\r\n          break;\r\n      }\r\n      if (ext[i].hasOwnProperty(listeners)) {\r\n        for (var ln in ext[i].listeners) {\r\n          if (ext[i].listeners.hasOwnProperty(ln)) {\r\n            listen(ln, ext[i].listeners[ln]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * LEGACY_SUPPORT\r\n   * @param {*} ext\r\n   * @param {string} name\r\n   */\r\n  function legacyExtensionLoading(ext, name) {\r\n    if (typeof ext === 'function') {\r\n      ext = ext(new showdown.Converter());\r\n    }\r\n    if (!showdown.helper.isArray(ext)) {\r\n      ext = [ext];\r\n    }\r\n    var valid = validate(ext, name);\r\n\r\n    if (!valid.valid) {\r\n      throw Error(valid.error);\r\n    }\r\n\r\n    for (var i = 0; i < ext.length; ++i) {\r\n      switch (ext[i].type) {\r\n        case 'lang':\r\n          langExtensions.push(ext[i]);\r\n          break;\r\n        case 'output':\r\n          outputModifiers.push(ext[i]);\r\n          break;\r\n        default:// should never reach here\r\n          throw Error('Extension loader error: Type unrecognized!!!');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to an event\r\n   * @param {string} name\r\n   * @param {function} callback\r\n   */\r\n  function listen(name, callback) {\r\n    if (!showdown.helper.isString(name)) {\r\n      throw Error('Invalid argument in converter.listen() method: name must be a string, but ' + typeof name + ' given');\r\n    }\r\n\r\n    if (typeof callback !== 'function') {\r\n      throw Error('Invalid argument in converter.listen() method: callback must be a function, but ' + typeof callback + ' given');\r\n    }\r\n\r\n    if (!listeners.hasOwnProperty(name)) {\r\n      listeners[name] = [];\r\n    }\r\n    listeners[name].push(callback);\r\n  }\r\n\r\n  function rTrimInputText(text) {\r\n    var rsp = text.match(/^\\s*/)[0].length,\r\n        rgx = new RegExp('^\\\\s{0,' + rsp + '}', 'gm');\r\n    return text.replace(rgx, '');\r\n  }\r\n\r\n  /**\r\n   * Dispatch an event\r\n   * @private\r\n   * @param {string} evtName Event name\r\n   * @param {string} text Text\r\n   * @param {{}} options Converter Options\r\n   * @param {{}} globals\r\n   * @returns {string}\r\n   */\r\n  this._dispatch = function dispatch (evtName, text, options, globals) {\r\n    if (listeners.hasOwnProperty(evtName)) {\r\n      for (var ei = 0; ei < listeners[evtName].length; ++ei) {\r\n        var nText = listeners[evtName][ei](evtName, text, this, options, globals);\r\n        if (nText && typeof nText !== 'undefined') {\r\n          text = nText;\r\n        }\r\n      }\r\n    }\r\n    return text;\r\n  };\r\n\r\n  /**\r\n   * Listen to an event\r\n   * @param {string} name\r\n   * @param {function} callback\r\n   * @returns {showdown.Converter}\r\n   */\r\n  this.listen = function (name, callback) {\r\n    listen(name, callback);\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Converts a markdown string into HTML\r\n   * @param {string} text\r\n   * @returns {*}\r\n   */\r\n  this.makeHtml = function (text) {\r\n    //check if text is not falsy\r\n    if (!text) {\r\n      return text;\r\n    }\r\n\r\n    var globals = {\r\n      gHtmlBlocks:     [],\r\n      gHtmlMdBlocks:   [],\r\n      gHtmlSpans:      [],\r\n      gUrls:           {},\r\n      gTitles:         {},\r\n      gDimensions:     {},\r\n      gListLevel:      0,\r\n      hashLinkCounts:  {},\r\n      langExtensions:  langExtensions,\r\n      outputModifiers: outputModifiers,\r\n      converter:       this,\r\n      ghCodeBlocks:    []\r\n    };\r\n\r\n    // attacklab: Replace ~ with ~T\r\n    // This lets us use tilde as an escape char to avoid md5 hashes\r\n    // The choice of character is arbitrary; anything that isn't\r\n    // magic in Markdown will work.\r\n    text = text.replace(/~/g, '~T');\r\n\r\n    // attacklab: Replace $ with ~D\r\n    // RegExp interprets $ as a special character\r\n    // when it's in a replacement string\r\n    text = text.replace(/\\$/g, '~D');\r\n\r\n    // Standardize line endings\r\n    text = text.replace(/\\r\\n/g, '\\n'); // DOS to Unix\r\n    text = text.replace(/\\r/g, '\\n'); // Mac to Unix\r\n\r\n    if (options.smartIndentationFix) {\r\n      text = rTrimInputText(text);\r\n    }\r\n\r\n    // Make sure text begins and ends with a couple of newlines:\r\n    //text = '\\n\\n' + text + '\\n\\n';\r\n    text = text;\r\n    // detab\r\n    text = showdown.subParser('detab')(text, options, globals);\r\n\r\n    // stripBlankLines\r\n    text = showdown.subParser('stripBlankLines')(text, options, globals);\r\n\r\n    //run languageExtensions\r\n    showdown.helper.forEach(langExtensions, function (ext) {\r\n      text = showdown.subParser('runExtension')(ext, text, options, globals);\r\n    });\r\n\r\n    // run the sub parsers\r\n    text = showdown.subParser('hashPreCodeTags')(text, options, globals);\r\n    text = showdown.subParser('githubCodeBlocks')(text, options, globals);\r\n    text = showdown.subParser('hashHTMLBlocks')(text, options, globals);\r\n    text = showdown.subParser('hashHTMLSpans')(text, options, globals);\r\n    text = showdown.subParser('stripLinkDefinitions')(text, options, globals);\r\n    text = showdown.subParser('blockGamut')(text, options, globals);\r\n    text = showdown.subParser('unhashHTMLSpans')(text, options, globals);\r\n    text = showdown.subParser('unescapeSpecialChars')(text, options, globals);\r\n\r\n    // attacklab: Restore dollar signs\r\n    text = text.replace(/~D/g, '$$');\r\n\r\n    // attacklab: Restore tildes\r\n    text = text.replace(/~T/g, '~');\r\n\r\n    // Run output modifiers\r\n    showdown.helper.forEach(outputModifiers, function (ext) {\r\n      text = showdown.subParser('runExtension')(ext, text, options, globals);\r\n    });\r\n    return text;\r\n  };\r\n\r\n  /**\r\n   * Set an option of this Converter instance\r\n   * @param {string} key\r\n   * @param {*} value\r\n   */\r\n  this.setOption = function (key, value) {\r\n    options[key] = value;\r\n  };\r\n\r\n  /**\r\n   * Get the option of this Converter instance\r\n   * @param {string} key\r\n   * @returns {*}\r\n   */\r\n  this.getOption = function (key) {\r\n    return options[key];\r\n  };\r\n\r\n  /**\r\n   * Get the options of this Converter instance\r\n   * @returns {{}}\r\n   */\r\n  this.getOptions = function () {\r\n    return options;\r\n  };\r\n\r\n  /**\r\n   * Add extension to THIS converter\r\n   * @param {{}} extension\r\n   * @param {string} [name=null]\r\n   */\r\n  this.addExtension = function (extension, name) {\r\n    name = name || null;\r\n    _parseExtension(extension, name);\r\n  };\r\n\r\n  /**\r\n   * Use a global registered extension with THIS converter\r\n   * @param {string} extensionName Name of the previously registered extension\r\n   */\r\n  this.useExtension = function (extensionName) {\r\n    _parseExtension(extensionName);\r\n  };\r\n\r\n  /**\r\n   * Set the flavor THIS converter should use\r\n   * @param {string} name\r\n   */\r\n  this.setFlavor = function (name) {\r\n    if (flavor.hasOwnProperty(name)) {\r\n      var preset = flavor[name];\r\n      for (var option in preset) {\r\n        if (preset.hasOwnProperty(option)) {\r\n          options[option] = preset[option];\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Remove an extension from THIS converter.\r\n   * Note: This is a costly operation. It's better to initialize a new converter\r\n   * and specify the extensions you wish to use\r\n   * @param {Array} extension\r\n   */\r\n  this.removeExtension = function (extension) {\r\n    if (!showdown.helper.isArray(extension)) {\r\n      extension = [extension];\r\n    }\r\n    for (var a = 0; a < extension.length; ++a) {\r\n      var ext = extension[a];\r\n      for (var i = 0; i < langExtensions.length; ++i) {\r\n        if (langExtensions[i] === ext) {\r\n          langExtensions[i].splice(i, 1);\r\n        }\r\n      }\r\n      for (var ii = 0; ii < outputModifiers.length; ++i) {\r\n        if (outputModifiers[ii] === ext) {\r\n          outputModifiers[ii].splice(i, 1);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Get all extension of THIS converter\r\n   * @returns {{language: Array, output: Array}}\r\n   */\r\n  this.getAllExtensions = function () {\r\n    return {\r\n      language: langExtensions,\r\n      output: outputModifiers\r\n    };\r\n  };\r\n};\r\n\r\n/**\r\n * Turn Markdown link shortcuts into XHTML <a> tags.\r\n */\r\nshowdown.subParser('anchors', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('anchors.before', text, options, globals);\r\n\r\n  var writeAnchorTag = function (wholeMatch, m1, m2, m3, m4, m5, m6, m7) {\r\n    if (showdown.helper.isUndefined(m7)) {\r\n      m7 = '';\r\n    }\r\n    wholeMatch = m1;\r\n    var linkText = m2,\r\n        linkId = m3.toLowerCase(),\r\n        url = m4,\r\n        title = m7;\r\n\r\n    if (!url) {\r\n      if (!linkId) {\r\n        // lower-case and turn embedded newlines into spaces\r\n        linkId = linkText.toLowerCase().replace(/ ?\\n/g, ' ');\r\n      }\r\n      url = '#' + linkId;\r\n\r\n      if (!showdown.helper.isUndefined(globals.gUrls[linkId])) {\r\n        url = globals.gUrls[linkId];\r\n        if (!showdown.helper.isUndefined(globals.gTitles[linkId])) {\r\n          title = globals.gTitles[linkId];\r\n        }\r\n      } else {\r\n        if (wholeMatch.search(/\\(\\s*\\)$/m) > -1) {\r\n          // Special case for explicit empty url\r\n          url = '';\r\n        } else {\r\n          return wholeMatch;\r\n        }\r\n      }\r\n    }\r\n\r\n    url = showdown.helper.escapeCharacters(url, '*_', false);\r\n    var result = '<a href=\"' + url + '\"';\r\n\r\n    if (title !== '' && title !== null) {\r\n      title = title.replace(/\"/g, '&quot;');\r\n      title = showdown.helper.escapeCharacters(title, '*_', false);\r\n      result += ' title=\"' + title + '\"';\r\n    }\r\n\r\n    result += '>' + linkText + '</a>';\r\n\r\n    return result;\r\n  };\r\n\r\n  // First, handle reference-style links: [link text] [id]\r\n  /*\r\n   text = text.replace(/\r\n   (\t\t\t\t\t\t\t// wrap whole match in $1\r\n   \\[\r\n   (\r\n   (?:\r\n   \\[[^\\]]*\\]\t\t// allow brackets nested one level\r\n   |\r\n   [^\\[]\t\t\t// or anything else\r\n   )*\r\n   )\r\n   \\]\r\n\r\n   [ ]?\t\t\t\t\t// one optional space\r\n   (?:\\n[ ]*)?\t\t\t\t// one optional newline followed by spaces\r\n\r\n   \\[\r\n   (.*?)\t\t\t\t\t// id = $3\r\n   \\]\r\n   )()()()()\t\t\t\t\t// pad remaining backreferences\r\n   /g,_DoAnchors_callback);\r\n   */\r\n  text = text.replace(/(\\[((?:\\[[^\\]]*]|[^\\[\\]])*)][ ]?(?:\\n[ ]*)?\\[(.*?)])()()()()/g, writeAnchorTag);\r\n\r\n  //\r\n  // Next, inline-style links: [link text](url \"optional title\")\r\n  //\r\n\r\n  /*\r\n   text = text.replace(/\r\n   (\t\t\t\t\t\t// wrap whole match in $1\r\n   \\[\r\n   (\r\n   (?:\r\n   \\[[^\\]]*\\]\t// allow brackets nested one level\r\n   |\r\n   [^\\[\\]]\t\t\t// or anything else\r\n   )\r\n   )\r\n   \\]\r\n   \\(\t\t\t\t\t\t// literal paren\r\n   [ \\t]*\r\n   ()\t\t\t\t\t\t// no id, so leave $3 empty\r\n   <?(.*?)>?\t\t\t\t// href = $4\r\n   [ \\t]*\r\n   (\t\t\t\t\t\t// $5\r\n   (['\"])\t\t\t\t// quote char = $6\r\n   (.*?)\t\t\t\t// Title = $7\r\n   \\6\t\t\t\t\t// matching quote\r\n   [ \\t]*\t\t\t\t// ignore any spaces/tabs between closing quote and )\r\n   )?\t\t\t\t\t\t// title is optional\r\n   \\)\r\n   )\r\n   /g,writeAnchorTag);\r\n   */\r\n  text = text.replace(/(\\[((?:\\[[^\\]]*]|[^\\[\\]])*)]\\([ \\t]*()<?(.*?(?:\\(.*?\\).*?)?)>?[ \\t]*((['\"])(.*?)\\6[ \\t]*)?\\))/g,\r\n                      writeAnchorTag);\r\n\r\n  //\r\n  // Last, handle reference-style shortcuts: [link text]\r\n  // These must come last in case you've also got [link test][1]\r\n  // or [link test](/foo)\r\n  //\r\n\r\n  /*\r\n   text = text.replace(/\r\n   (                // wrap whole match in $1\r\n   \\[\r\n   ([^\\[\\]]+)       // link text = $2; can't contain '[' or ']'\r\n   \\]\r\n   )()()()()()      // pad rest of backreferences\r\n   /g, writeAnchorTag);\r\n   */\r\n  text = text.replace(/(\\[([^\\[\\]]+)])()()()()()/g, writeAnchorTag);\r\n\r\n  text = globals.converter._dispatch('anchors.after', text, options, globals);\r\n  return text;\r\n});\r\n\r\nshowdown.subParser('autoLinks', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('autoLinks.before', text, options, globals);\r\n\r\n  var simpleURLRegex  = /\\b(((https?|ftp|dict):\\/\\/|www\\.)[^'\">\\s]+\\.[^'\">\\s]+)(?=\\s|$)(?![\"<>])/gi,\r\n      delimUrlRegex   = /<(((https?|ftp|dict):\\/\\/|www\\.)[^'\">\\s]+)>/gi,\r\n      simpleMailRegex = /(?:^|[ \\n\\t])([A-Za-z0-9!#$%&'*+-/=?^_`\\{|}~\\.]+@[-a-z0-9]+(\\.[-a-z0-9]+)*\\.[a-z]+)(?:$|[ \\n\\t])/gi,\r\n      delimMailRegex  = /<(?:mailto:)?([-.\\w]+@[-a-z0-9]+(\\.[-a-z0-9]+)*\\.[a-z]+)>/gi;\r\n\r\n  text = text.replace(delimUrlRegex, replaceLink);\r\n  text = text.replace(delimMailRegex, replaceMail);\r\n  // simpleURLRegex  = /\\b(((https?|ftp|dict):\\/\\/|www\\.)[-.+~:?#@!$&'()*,;=[\\]\\w]+)\\b/gi,\r\n  // Email addresses: <address@domain.foo>\r\n\r\n  if (options.simplifiedAutoLink) {\r\n    text = text.replace(simpleURLRegex, replaceLink);\r\n    text = text.replace(simpleMailRegex, replaceMail);\r\n  }\r\n\r\n  function replaceLink(wm, link) {\r\n    var lnkTxt = link;\r\n    if (/^www\\./i.test(link)) {\r\n      link = link.replace(/^www\\./i, 'http://www.');\r\n    }\r\n    return '<a href=\"' + link + '\">' + lnkTxt + '</a>';\r\n  }\r\n\r\n  function replaceMail(wholeMatch, m1) {\r\n    var unescapedStr = showdown.subParser('unescapeSpecialChars')(m1);\r\n    return showdown.subParser('encodeEmailAddress')(unescapedStr);\r\n  }\r\n\r\n  text = globals.converter._dispatch('autoLinks.after', text, options, globals);\r\n\r\n  return text;\r\n});\r\n\r\n/**\r\n * These are all the transformations that form block-level\r\n * tags like paragraphs, headers, and list items.\r\n */\r\nshowdown.subParser('blockGamut', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('blockGamut.before', text, options, globals);\r\n\r\n  // we parse blockquotes first so that we can have headings and hrs\r\n  // inside blockquotes\r\n  text = showdown.subParser('blockQuotes')(text, options, globals);\r\n  text = showdown.subParser('headers')(text, options, globals);\r\n\r\n  // Do Horizontal Rules:\r\n  var key = showdown.subParser('hashBlock')('<hr />', options, globals);\r\n  text = text.replace(/^[ ]{0,2}([ ]?\\*[ ]?){3,}[ \\t]*$/gm, key);\r\n  text = text.replace(/^[ ]{0,2}([ ]?\\-[ ]?){3,}[ \\t]*$/gm, key);\r\n  text = text.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \\t]*$/gm, key);\r\n\r\n  text = showdown.subParser('lists')(text, options, globals);\r\n  text = showdown.subParser('codeBlocks')(text, options, globals);\r\n  text = showdown.subParser('tables')(text, options, globals);\r\n\r\n  // We already ran _HashHTMLBlocks() before, in Markdown(), but that\r\n  // was to escape raw HTML in the original Markdown source. This time,\r\n  // we're escaping the markup we've just created, so that we don't wrap\r\n  // <p> tags around block-level tags.\r\n  text = showdown.subParser('hashHTMLBlocks')(text, options, globals);\r\n  text = showdown.subParser('paragraphs')(text, options, globals);\r\n\r\n  text = globals.converter._dispatch('blockGamut.after', text, options, globals);\r\n\r\n  return text;\r\n});\r\n\r\nshowdown.subParser('blockQuotes', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('blockQuotes.before', text, options, globals);\r\n  /*\r\n   text = text.replace(/\r\n   (\t\t\t\t\t\t\t\t// Wrap whole match in $1\r\n   (\r\n   ^[ \\t]*>[ \\t]?\t\t\t// '>' at the start of a line\r\n   .+\\n\t\t\t\t\t// rest of the first line\r\n   (.+\\n)*\t\t\t\t\t// subsequent consecutive lines\r\n   \\n*\t\t\t\t\t\t// blanks\r\n   )+\r\n   )\r\n   /gm, function(){...});\r\n   */\r\n\r\n  text = text.replace(/((^[ \\t]{0,3}>[ \\t]?.+\\n(.+\\n)*\\n*)+)/gm, function (wholeMatch, m1) {\r\n    var bq = m1;\r\n\r\n    // attacklab: hack around Konqueror 3.5.4 bug:\r\n    // \"----------bug\".replace(/^-/g,\"\") == \"bug\"\r\n    bq = bq.replace(/^[ \\t]*>[ \\t]?/gm, '~0'); // trim one level of quoting\r\n\r\n    // attacklab: clean up hack\r\n    bq = bq.replace(/~0/g, '');\r\n\r\n    bq = bq.replace(/^[ \\t]+$/gm, ''); // trim whitespace-only lines\r\n    bq = showdown.subParser('githubCodeBlocks')(bq, options, globals);\r\n    bq = showdown.subParser('blockGamut')(bq, options, globals); // recurse\r\n\r\n    bq = bq.replace(/(^|\\n)/g, '$1  ');\r\n    // These leading spaces screw with <pre> content, so we need to fix that:\r\n    bq = bq.replace(/(\\s*<pre>[^\\r]+?<\\/pre>)/gm, function (wholeMatch, m1) {\r\n      var pre = m1;\r\n      // attacklab: hack around Konqueror 3.5.4 bug:\r\n      pre = pre.replace(/^  /mg, '~0');\r\n      pre = pre.replace(/~0/g, '');\r\n      return pre;\r\n    });\r\n\r\n    return showdown.subParser('hashBlock')('<blockquote>\\n' + bq + '\\n</blockquote>', options, globals);\r\n  });\r\n\r\n  text = globals.converter._dispatch('blockQuotes.after', text, options, globals);\r\n  return text;\r\n});\r\n\r\n/**\r\n * Process Markdown `<pre><code>` blocks.\r\n */\r\nshowdown.subParser('codeBlocks', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('codeBlocks.before', text, options, globals);\r\n  /*\r\n   text = text.replace(text,\r\n   /(?:\\n\\n|^)\r\n   (\t\t\t\t\t\t\t\t// $1 = the code block -- one or more lines, starting with a space/tab\r\n   (?:\r\n   (?:[ ]{4}|\\t)\t\t\t// Lines must start with a tab or a tab-width of spaces - attacklab: g_tab_width\r\n   .*\\n+\r\n   )+\r\n   )\r\n   (\\n*[ ]{0,3}[^ \\t\\n]|(?=~0))\t// attacklab: g_tab_width\r\n   /g,function(){...});\r\n   */\r\n\r\n  // attacklab: sentinel workarounds for lack of \\A and \\Z, safari\\khtml bug\r\n  text += '~0';\r\n\r\n  var pattern = /(?:\\n\\n|^)((?:(?:[ ]{4}|\\t).*\\n+)+)(\\n*[ ]{0,3}[^ \\t\\n]|(?=~0))/g;\r\n  text = text.replace(pattern, function (wholeMatch, m1, m2) {\r\n    var codeblock = m1,\r\n        nextChar = m2,\r\n        end = '\\n';\r\n\r\n    codeblock = showdown.subParser('outdent')(codeblock);\r\n    codeblock = showdown.subParser('encodeCode')(codeblock);\r\n    codeblock = showdown.subParser('detab')(codeblock);\r\n    codeblock = codeblock.replace(/^\\n+/g, ''); // trim leading newlines\r\n    codeblock = codeblock.replace(/\\n+$/g, ''); // trim trailing newlines\r\n\r\n    if (options.omitExtraWLInCodeBlocks) {\r\n      end = '';\r\n    }\r\n\r\n    codeblock = '<pre><code>' + codeblock + end + '</code></pre>';\r\n\r\n    return showdown.subParser('hashBlock')(codeblock, options, globals) + nextChar;\r\n  });\r\n\r\n  // attacklab: strip sentinel\r\n  text = text.replace(/~0/, '');\r\n\r\n  text = globals.converter._dispatch('codeBlocks.after', text, options, globals);\r\n  return text;\r\n});\r\n\r\n/**\r\n *\r\n *   *  Backtick quotes are used for <code></code> spans.\r\n *\r\n *   *  You can use multiple backticks as the delimiters if you want to\r\n *     include literal backticks in the code span. So, this input:\r\n *\r\n *         Just type ``foo `bar` baz`` at the prompt.\r\n *\r\n *       Will translate to:\r\n *\r\n *         <p>Just type <code>foo `bar` baz</code> at the prompt.</p>\r\n *\r\n *    There's no arbitrary limit to the number of backticks you\r\n *    can use as delimters. If you need three consecutive backticks\r\n *    in your code, use four for delimiters, etc.\r\n *\r\n *  *  You can use spaces to get literal backticks at the edges:\r\n *\r\n *         ... type `` `bar` `` ...\r\n *\r\n *       Turns to:\r\n *\r\n *         ... type <code>`bar`</code> ...\r\n */\r\nshowdown.subParser('codeSpans', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('codeSpans.before', text, options, globals);\r\n\r\n  /*\r\n   text = text.replace(/\r\n   (^|[^\\\\])\t\t\t\t\t// Character before opening ` can't be a backslash\r\n   (`+)\t\t\t\t\t\t// $2 = Opening run of `\r\n   (\t\t\t\t\t\t\t// $3 = The code block\r\n   [^\\r]*?\r\n   [^`]\t\t\t\t\t// attacklab: work around lack of lookbehind\r\n   )\r\n   \\2\t\t\t\t\t\t\t// Matching closer\r\n   (?!`)\r\n   /gm, function(){...});\r\n   */\r\n\r\n  if (typeof(text) === 'undefined') {\r\n    text = '';\r\n  }\r\n  text = text.replace(/(^|[^\\\\])(`+)([^\\r]*?[^`])\\2(?!`)/gm,\r\n    function (wholeMatch, m1, m2, m3) {\r\n      var c = m3;\r\n      c = c.replace(/^([ \\t]*)/g, '');\t// leading whitespace\r\n      c = c.replace(/[ \\t]*$/g, '');\t// trailing whitespace\r\n      c = showdown.subParser('encodeCode')(c);\r\n      return m1 + '<code>' + c + '</code>';\r\n    }\r\n  );\r\n\r\n  text = globals.converter._dispatch('codeSpans.after', text, options, globals);\r\n  return text;\r\n});\r\n\r\n/**\r\n * Convert all tabs to spaces\r\n */\r\nshowdown.subParser('detab', function (text) {\r\n  'use strict';\r\n\r\n  // expand first n-1 tabs\r\n  text = text.replace(/\\t(?=\\t)/g, '    '); // g_tab_width\r\n\r\n  // replace the nth with two sentinels\r\n  text = text.replace(/\\t/g, '~A~B');\r\n\r\n  // use the sentinel to anchor our regex so it doesn't explode\r\n  text = text.replace(/~B(.+?)~A/g, function (wholeMatch, m1) {\r\n    var leadingText = m1,\r\n        numSpaces = 4 - leadingText.length % 4;  // g_tab_width\r\n\r\n    // there *must* be a better way to do this:\r\n    for (var i = 0; i < numSpaces; i++) {\r\n      leadingText += ' ';\r\n    }\r\n\r\n    return leadingText;\r\n  });\r\n\r\n  // clean up sentinels\r\n  text = text.replace(/~A/g, '    ');  // g_tab_width\r\n  text = text.replace(/~B/g, '');\r\n\r\n  return text;\r\n\r\n});\r\n\r\n/**\r\n * Smart processing for ampersands and angle brackets that need to be encoded.\r\n */\r\nshowdown.subParser('encodeAmpsAndAngles', function (text) {\r\n  'use strict';\r\n  // Ampersand-encoding based entirely on Nat Irons's Amputator MT plugin:\r\n  // http://bumppo.net/projects/amputator/\r\n  text = text.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\\w+);)/g, '&amp;');\r\n\r\n  // Encode naked <'s\r\n  text = text.replace(/<(?![a-z\\/?\\$!])/gi, '&lt;');\r\n\r\n  return text;\r\n});\r\n\r\n/**\r\n * Returns the string, with after processing the following backslash escape sequences.\r\n *\r\n * attacklab: The polite way to do this is with the new escapeCharacters() function:\r\n *\r\n *    text = escapeCharacters(text,\"\\\\\",true);\r\n *    text = escapeCharacters(text,\"`*_{}[]()>#+-.!\",true);\r\n *\r\n * ...but we're sidestepping its use of the (slow) RegExp constructor\r\n * as an optimization for Firefox.  This function gets called a LOT.\r\n */\r\nshowdown.subParser('encodeBackslashEscapes', function (text) {\r\n  'use strict';\r\n  text = text.replace(/\\\\(\\\\)/g, showdown.helper.escapeCharactersCallback);\r\n  text = text.replace(/\\\\([`*_{}\\[\\]()>#+-.!])/g, showdown.helper.escapeCharactersCallback);\r\n  return text;\r\n});\r\n\r\n/**\r\n * Encode/escape certain characters inside Markdown code runs.\r\n * The point is that in code, these characters are literals,\r\n * and lose their special Markdown meanings.\r\n */\r\nshowdown.subParser('encodeCode', function (text) {\r\n  'use strict';\r\n\r\n  // Encode all ampersands; HTML entities are not\r\n  // entities within a Markdown code span.\r\n  text = text.replace(/&/g, '&amp;');\r\n\r\n  // Do the angle bracket song and dance:\r\n  text = text.replace(/</g, '&lt;');\r\n  text = text.replace(/>/g, '&gt;');\r\n\r\n  // Now, escape characters that are magic in Markdown:\r\n  text = showdown.helper.escapeCharacters(text, '*_{}[]\\\\', false);\r\n\r\n  // jj the line above breaks this:\r\n  //---\r\n  //* Item\r\n  //   1. Subitem\r\n  //            special char: *\r\n  // ---\r\n\r\n  return text;\r\n});\r\n\r\n/**\r\n *  Input: an email address, e.g. \"foo@example.com\"\r\n *\r\n *  Output: the email address as a mailto link, with each character\r\n *    of the address encoded as either a decimal or hex entity, in\r\n *    the hopes of foiling most address harvesting spam bots. E.g.:\r\n *\r\n *    <a href=\"&#x6D;&#97;&#105;&#108;&#x74;&#111;:&#102;&#111;&#111;&#64;&#101;\r\n *       x&#x61;&#109;&#x70;&#108;&#x65;&#x2E;&#99;&#111;&#109;\">&#102;&#111;&#111;\r\n *       &#64;&#101;x&#x61;&#109;&#x70;&#108;&#x65;&#x2E;&#99;&#111;&#109;</a>\r\n *\r\n *  Based on a filter by Matthew Wickline, posted to the BBEdit-Talk\r\n *  mailing list: <http://tinyurl.com/yu7ue>\r\n *\r\n */\r\nshowdown.subParser('encodeEmailAddress', function (addr) {\r\n  'use strict';\r\n\r\n  var encode = [\r\n    function (ch) {\r\n      return '&#' + ch.charCodeAt(0) + ';';\r\n    },\r\n    function (ch) {\r\n      return '&#x' + ch.charCodeAt(0).toString(16) + ';';\r\n    },\r\n    function (ch) {\r\n      return ch;\r\n    }\r\n  ];\r\n\r\n  addr = 'mailto:' + addr;\r\n\r\n  addr = addr.replace(/./g, function (ch) {\r\n    if (ch === '@') {\r\n      // this *must* be encoded. I insist.\r\n      ch = encode[Math.floor(Math.random() * 2)](ch);\r\n    } else if (ch !== ':') {\r\n      // leave ':' alone (to spot mailto: later)\r\n      var r = Math.random();\r\n      // roughly 10% raw, 45% hex, 45% dec\r\n      ch = (\r\n        r > 0.9 ? encode[2](ch) : r > 0.45 ? encode[1](ch) : encode[0](ch)\r\n      );\r\n    }\r\n    return ch;\r\n  });\r\n\r\n  addr = '<a href=\"' + addr + '\">' + addr + '</a>';\r\n  addr = addr.replace(/\">.+:/g, '\">'); // strip the mailto: from the visible part\r\n\r\n  return addr;\r\n});\r\n\r\n/**\r\n * Within tags -- meaning between < and > -- encode [\\ ` * _] so they\r\n * don't conflict with their use in Markdown for code, italics and strong.\r\n */\r\nshowdown.subParser('escapeSpecialCharsWithinTagAttributes', function (text) {\r\n  'use strict';\r\n\r\n  // Build a regex to find HTML tags and comments.  See Friedl's\r\n  // \"Mastering Regular Expressions\", 2nd Ed., pp. 200-201.\r\n  var regex = /(<[a-z\\/!$](\"[^\"]*\"|'[^']*'|[^'\">])*>|<!(--.*?--\\s*)+>)/gi;\r\n\r\n  text = text.replace(regex, function (wholeMatch) {\r\n    var tag = wholeMatch.replace(/(.)<\\/?code>(?=.)/g, '$1`');\r\n    tag = showdown.helper.escapeCharacters(tag, '\\\\`*_', false);\r\n    return tag;\r\n  });\r\n\r\n  return text;\r\n});\r\n\r\n/**\r\n * Handle github codeblocks prior to running HashHTML so that\r\n * HTML contained within the codeblock gets escaped properly\r\n * Example:\r\n * ```ruby\r\n *     def hello_world(x)\r\n *       puts \"Hello, #{x}\"\r\n *     end\r\n * ```\r\n */\r\nshowdown.subParser('githubCodeBlocks', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  // early exit if option is not enabled\r\n  if (!options.ghCodeBlocks) {\r\n    return text;\r\n  }\r\n\r\n  text = globals.converter._dispatch('githubCodeBlocks.before', text, options, globals);\r\n\r\n  text += '~0';\r\n\r\n  text = text.replace(/(?:^|\\n)```(.*)\\n([\\s\\S]*?)\\n```/g, function (wholeMatch, language, codeblock) {\r\n    var end = (options.omitExtraWLInCodeBlocks) ? '' : '\\n';\r\n\r\n    // First parse the github code block\r\n    codeblock = showdown.subParser('encodeCode')(codeblock);\r\n    codeblock = showdown.subParser('detab')(codeblock);\r\n    codeblock = codeblock.replace(/^\\n+/g, ''); // trim leading newlines\r\n    codeblock = codeblock.replace(/\\n+$/g, ''); // trim trailing whitespace\r\n\r\n    codeblock = '<pre><code' + (language ? ' class=\"' + language + ' language-' + language + '\"' : '') + '>' + codeblock + end + '</code></pre>';\r\n\r\n    codeblock = showdown.subParser('hashBlock')(codeblock, options, globals);\r\n\r\n    // Since GHCodeblocks can be false positives, we need to\r\n    // store the primitive text and the parsed text in a global var,\r\n    // and then return a token\r\n    return '\\n\\n~G' + (globals.ghCodeBlocks.push({text: wholeMatch, codeblock: codeblock}) - 1) + 'G\\n\\n';\r\n  });\r\n\r\n  // attacklab: strip sentinel\r\n  text = text.replace(/~0/, '');\r\n\r\n  return globals.converter._dispatch('githubCodeBlocks.after', text, options, globals);\r\n});\r\n\r\nshowdown.subParser('hashBlock', function (text, options, globals) {\r\n  'use strict';\r\n  text = text.replace(/(^\\n+|\\n+$)/g, '');\r\n  return '\\n\\n~K' + (globals.gHtmlBlocks.push(text) - 1) + 'K\\n\\n';\r\n});\r\n\r\nshowdown.subParser('hashElement', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  return function (wholeMatch, m1) {\r\n    var blockText = m1;\r\n\r\n    // Undo double lines\r\n    blockText = blockText.replace(/\\n\\n/g, '\\n');\r\n    blockText = blockText.replace(/^\\n/, '');\r\n\r\n    // strip trailing blank lines\r\n    blockText = blockText.replace(/\\n+$/g, '');\r\n\r\n    // Replace the element text with a marker (\"~KxK\" where x is its key)\r\n    blockText = '\\n\\n~K' + (globals.gHtmlBlocks.push(blockText) - 1) + 'K\\n\\n';\r\n\r\n    return blockText;\r\n  };\r\n});\r\n\r\nshowdown.subParser('hashHTMLBlocks', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  var blockTags = [\r\n      'pre',\r\n      'div',\r\n      'h1',\r\n      'h2',\r\n      'h3',\r\n      'h4',\r\n      'h5',\r\n      'h6',\r\n      'blockquote',\r\n      'table',\r\n      'dl',\r\n      'ol',\r\n      'ul',\r\n      'script',\r\n      'noscript',\r\n      'form',\r\n      'fieldset',\r\n      'iframe',\r\n      'math',\r\n      'style',\r\n      'section',\r\n      'header',\r\n      'footer',\r\n      'nav',\r\n      'article',\r\n      'aside',\r\n      'address',\r\n      'audio',\r\n      'canvas',\r\n      'figure',\r\n      'hgroup',\r\n      'output',\r\n      'video',\r\n      'p'\r\n    ],\r\n    repFunc = function (wholeMatch, match, left, right) {\r\n      var txt = wholeMatch;\r\n      // check if this html element is marked as markdown\r\n      // if so, it's contents should be parsed as markdown\r\n      if (left.search(/\\bmarkdown\\b/) !== -1) {\r\n        txt = left + globals.converter.makeHtml(match) + right;\r\n      }\r\n      return '\\n\\n~K' + (globals.gHtmlBlocks.push(txt) - 1) + 'K\\n\\n';\r\n    };\r\n\r\n  for (var i = 0; i < blockTags.length; ++i) {\r\n    text = showdown.helper.replaceRecursiveRegExp(text, repFunc, '^(?: |\\\\t){0,3}<' + blockTags[i] + '\\\\b[^>]*>', '</' + blockTags[i] + '>', 'gim');\r\n  }\r\n\r\n  // HR SPECIAL CASE\r\n  text = text.replace(/(\\n[ ]{0,3}(<(hr)\\b([^<>])*?\\/?>)[ \\t]*(?=\\n{2,}))/g,\r\n    showdown.subParser('hashElement')(text, options, globals));\r\n\r\n  // Special case for standalone HTML comments:\r\n  text = text.replace(/(<!--[\\s\\S]*?-->)/g,\r\n    showdown.subParser('hashElement')(text, options, globals));\r\n\r\n  // PHP and ASP-style processor instructions (<?...?> and <%...%>)\r\n  text = text.replace(/(?:\\n\\n)([ ]{0,3}(?:<([?%])[^\\r]*?\\2>)[ \\t]*(?=\\n{2,}))/g,\r\n    showdown.subParser('hashElement')(text, options, globals));\r\n  return text;\r\n});\r\n\r\n/**\r\n * Hash span elements that should not be parsed as markdown\r\n */\r\nshowdown.subParser('hashHTMLSpans', function (text, config, globals) {\r\n  'use strict';\r\n\r\n  var matches = showdown.helper.matchRecursiveRegExp(text, '<code\\\\b[^>]*>', '</code>', 'gi');\r\n\r\n  for (var i = 0; i < matches.length; ++i) {\r\n    text = text.replace(matches[i][0], '~L' + (globals.gHtmlSpans.push(matches[i][0]) - 1) + 'L');\r\n  }\r\n  return text;\r\n});\r\n\r\n/**\r\n * Unhash HTML spans\r\n */\r\nshowdown.subParser('unhashHTMLSpans', function (text, config, globals) {\r\n  'use strict';\r\n\r\n  for (var i = 0; i < globals.gHtmlSpans.length; ++i) {\r\n    text = text.replace('~L' + i + 'L', globals.gHtmlSpans[i]);\r\n  }\r\n\r\n  return text;\r\n});\r\n\r\n/**\r\n * Hash span elements that should not be parsed as markdown\r\n */\r\nshowdown.subParser('hashPreCodeTags', function (text, config, globals) {\r\n  'use strict';\r\n\r\n  var repFunc = function (wholeMatch, match, left, right) {\r\n    // encode html entities\r\n    var codeblock = left + showdown.subParser('encodeCode')(match) + right;\r\n    return '\\n\\n~G' + (globals.ghCodeBlocks.push({text: wholeMatch, codeblock: codeblock}) - 1) + 'G\\n\\n';\r\n  };\r\n\r\n  text = showdown.helper.replaceRecursiveRegExp(text, repFunc, '^(?: |\\\\t){0,3}<pre\\\\b[^>]*>\\\\s*<code\\\\b[^>]*>', '^(?: |\\\\t){0,3}</code>\\\\s*</pre>', 'gim');\r\n  return text;\r\n});\r\n\r\nshowdown.subParser('headers', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('headers.before', text, options, globals);\r\n\r\n  var prefixHeader = options.prefixHeaderId,\r\n      headerLevelStart = (isNaN(parseInt(options.headerLevelStart))) ? 1 : parseInt(options.headerLevelStart),\r\n\r\n  // Set text-style headers:\r\n  //\tHeader 1\r\n  //\t========\r\n  //\r\n  //\tHeader 2\r\n  //\t--------\r\n  //\r\n      setextRegexH1 = (options.smoothLivePreview) ? /^(.+)[ \\t]*\\n={2,}[ \\t]*\\n+/gm : /^(.+)[ \\t]*\\n=+[ \\t]*\\n+/gm,\r\n      setextRegexH2 = (options.smoothLivePreview) ? /^(.+)[ \\t]*\\n-{2,}[ \\t]*\\n+/gm : /^(.+)[ \\t]*\\n-+[ \\t]*\\n+/gm;\r\n\r\n  text = text.replace(setextRegexH1, function (wholeMatch, m1) {\r\n\r\n    var spanGamut = showdown.subParser('spanGamut')(m1, options, globals),\r\n        hID = (options.noHeaderId) ? '' : ' id=\"' + headerId(m1) + '\"',\r\n        hLevel = headerLevelStart,\r\n        hashBlock = '<h' + hLevel + hID + '>' + spanGamut + '</h' + hLevel + '>';\r\n    return showdown.subParser('hashBlock')(hashBlock, options, globals);\r\n  });\r\n\r\n  text = text.replace(setextRegexH2, function (matchFound, m1) {\r\n    var spanGamut = showdown.subParser('spanGamut')(m1, options, globals),\r\n        hID = (options.noHeaderId) ? '' : ' id=\"' + headerId(m1) + '\"',\r\n        hLevel = headerLevelStart + 1,\r\n      hashBlock = '<h' + hLevel + hID + '>' + spanGamut + '</h' + hLevel + '>';\r\n    return showdown.subParser('hashBlock')(hashBlock, options, globals);\r\n  });\r\n\r\n  // atx-style headers:\r\n  //  # Header 1\r\n  //  ## Header 2\r\n  //  ## Header 2 with closing hashes ##\r\n  //  ...\r\n  //  ###### Header 6\r\n  //\r\n  text = text.replace(/^(#{1,6})[ \\t]*(.+?)[ \\t]*#*\\n+/gm, function (wholeMatch, m1, m2) {\r\n    var span = showdown.subParser('spanGamut')(m2, options, globals),\r\n        hID = (options.noHeaderId) ? '' : ' id=\"' + headerId(m2) + '\"',\r\n        hLevel = headerLevelStart - 1 + m1.length,\r\n        header = '<h' + hLevel + hID + '>' + span + '</h' + hLevel + '>';\r\n\r\n    return showdown.subParser('hashBlock')(header, options, globals);\r\n  });\r\n\r\n  function headerId(m) {\r\n    var title, escapedId = m.replace(/[^\\w]/g, '').toLowerCase();\r\n\r\n    if (globals.hashLinkCounts[escapedId]) {\r\n      title = escapedId + '-' + (globals.hashLinkCounts[escapedId]++);\r\n    } else {\r\n      title = escapedId;\r\n      globals.hashLinkCounts[escapedId] = 1;\r\n    }\r\n\r\n    // Prefix id to prevent causing inadvertent pre-existing style matches.\r\n    if (prefixHeader === true) {\r\n      prefixHeader = 'section';\r\n    }\r\n\r\n    if (showdown.helper.isString(prefixHeader)) {\r\n      return prefixHeader + title;\r\n    }\r\n    return title;\r\n  }\r\n\r\n  text = globals.converter._dispatch('headers.after', text, options, globals);\r\n  return text;\r\n});\r\n\r\n/**\r\n * Turn Markdown image shortcuts into <img> tags.\r\n */\r\nshowdown.subParser('images', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('images.before', text, options, globals);\r\n\r\n  var inlineRegExp    = /!\\[(.*?)]\\s?\\([ \\t]*()<?(\\S+?)>?(?: =([*\\d]+[A-Za-z%]{0,4})x([*\\d]+[A-Za-z%]{0,4}))?[ \\t]*(?:(['\"])(.*?)\\6[ \\t]*)?\\)/g,\r\n      referenceRegExp = /!\\[([^\\]]*?)] ?(?:\\n *)?\\[(.*?)]()()()()()/g;\r\n\r\n  function writeImageTag (wholeMatch, altText, linkId, url, width, height, m5, title) {\r\n\r\n    var gUrls   = globals.gUrls,\r\n        gTitles = globals.gTitles,\r\n        gDims   = globals.gDimensions;\r\n\r\n    linkId = linkId.toLowerCase();\r\n\r\n    if (!title) {\r\n      title = '';\r\n    }\r\n\r\n    if (url === '' || url === null) {\r\n      if (linkId === '' || linkId === null) {\r\n        // lower-case and turn embedded newlines into spaces\r\n        linkId = altText.toLowerCase().replace(/ ?\\n/g, ' ');\r\n      }\r\n      url = '#' + linkId;\r\n\r\n      if (!showdown.helper.isUndefined(gUrls[linkId])) {\r\n        url = gUrls[linkId];\r\n        if (!showdown.helper.isUndefined(gTitles[linkId])) {\r\n          title = gTitles[linkId];\r\n        }\r\n        if (!showdown.helper.isUndefined(gDims[linkId])) {\r\n          width = gDims[linkId].width;\r\n          height = gDims[linkId].height;\r\n        }\r\n      } else {\r\n        return wholeMatch;\r\n      }\r\n    }\r\n\r\n    altText = altText.replace(/\"/g, '&quot;');\r\n    altText = showdown.helper.escapeCharacters(altText, '*_', false);\r\n    url = showdown.helper.escapeCharacters(url, '*_', false);\r\n    var result = '<img src=\"' + url + '\" alt=\"' + altText + '\"';\r\n\r\n    if (title) {\r\n      title = title.replace(/\"/g, '&quot;');\r\n      title = showdown.helper.escapeCharacters(title, '*_', false);\r\n      result += ' title=\"' + title + '\"';\r\n    }\r\n\r\n    if (width && height) {\r\n      width  = (width === '*') ? 'auto' : width;\r\n      height = (height === '*') ? 'auto' : height;\r\n\r\n      result += ' width=\"' + width + '\"';\r\n      result += ' height=\"' + height + '\"';\r\n    }\r\n\r\n    result += ' />';\r\n    return result;\r\n  }\r\n\r\n  // First, handle reference-style labeled images: ![alt text][id]\r\n  text = text.replace(referenceRegExp, writeImageTag);\r\n\r\n  // Next, handle inline images:  ![alt text](url =<width>x<height> \"optional title\")\r\n  text = text.replace(inlineRegExp, writeImageTag);\r\n\r\n  text = globals.converter._dispatch('images.after', text, options, globals);\r\n  return text;\r\n});\r\n\r\nshowdown.subParser('italicsAndBold', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('italicsAndBold.before', text, options, globals);\r\n\r\n  if (options.literalMidWordUnderscores) {\r\n    //underscores\r\n    // Since we are consuming a \\s character, we need to add it\r\n    text = text.replace(/(^|\\s|>|\\b)__(?=\\S)([\\s\\S]+?)__(?=\\b|<|\\s|$)/gm, '$1<strong>$2</strong>');\r\n    text = text.replace(/(^|\\s|>|\\b)_(?=\\S)([\\s\\S]+?)_(?=\\b|<|\\s|$)/gm, '$1<em>$2</em>');\r\n    //asterisks\r\n    text = text.replace(/(\\*\\*)(?=\\S)([^\\r]*?\\S[*]*)\\1/g, '<strong>$2</strong>');\r\n    text = text.replace(/(\\*)(?=\\S)([^\\r]*?\\S)\\1/g, '<em>$2</em>');\r\n\r\n  } else {\r\n    // <strong> must go first:\r\n    text = text.replace(/(\\*\\*|__)(?=\\S)([^\\r]*?\\S[*_]*)\\1/g, '<strong>$2</strong>');\r\n    text = text.replace(/(\\*|_)(?=\\S)([^\\r]*?\\S)\\1/g, '<em>$2</em>');\r\n  }\r\n\r\n  text = globals.converter._dispatch('italicsAndBold.after', text, options, globals);\r\n  return text;\r\n});\r\n\r\n/**\r\n * Form HTML ordered (numbered) and unordered (bulleted) lists.\r\n */\r\nshowdown.subParser('lists', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('lists.before', text, options, globals);\r\n  /**\r\n   * Process the contents of a single ordered or unordered list, splitting it\r\n   * into individual list items.\r\n   * @param {string} listStr\r\n   * @param {boolean} trimTrailing\r\n   * @returns {string}\r\n   */\r\n  function processListItems (listStr, trimTrailing) {\r\n    // The $g_list_level global keeps track of when we're inside a list.\r\n    // Each time we enter a list, we increment it; when we leave a list,\r\n    // we decrement. If it's zero, we're not in a list anymore.\r\n    //\r\n    // We do this because when we're not inside a list, we want to treat\r\n    // something like this:\r\n    //\r\n    //    I recommend upgrading to version\r\n    //    8. Oops, now this line is treated\r\n    //    as a sub-list.\r\n    //\r\n    // As a single paragraph, despite the fact that the second line starts\r\n    // with a digit-period-space sequence.\r\n    //\r\n    // Whereas when we're inside a list (or sub-list), that line will be\r\n    // treated as the start of a sub-list. What a kludge, huh? This is\r\n    // an aspect of Markdown's syntax that's hard to parse perfectly\r\n    // without resorting to mind-reading. Perhaps the solution is to\r\n    // change the syntax rules such that sub-lists must start with a\r\n    // starting cardinal number; e.g. \"1.\" or \"a.\".\r\n    globals.gListLevel++;\r\n\r\n    // trim trailing blank lines:\r\n    listStr = listStr.replace(/\\n{2,}$/, '\\n');\r\n\r\n    // attacklab: add sentinel to emulate \\z\r\n    listStr += '~0';\r\n\r\n    var rgx = /(\\n)?(^[ \\t]*)([*+-]|\\d+[.])[ \\t]+((\\[(x|X| )?])?[ \\t]*[^\\r]+?(\\n{1,2}))(?=\\n*(~0|\\2([*+-]|\\d+[.])[ \\t]+))/gm,\r\n        isParagraphed = (/\\n[ \\t]*\\n(?!~0)/.test(listStr));\r\n\r\n    listStr = listStr.replace(rgx, function (wholeMatch, m1, m2, m3, m4, taskbtn, checked) {\r\n      checked = (checked && checked.trim() !== '');\r\n      var item = showdown.subParser('outdent')(m4, options, globals),\r\n          bulletStyle = '';\r\n\r\n      // Support for github tasklists\r\n      if (taskbtn && options.tasklists) {\r\n        bulletStyle = ' class=\"task-list-item\" style=\"list-style-type: none;\"';\r\n        item = item.replace(/^[ \\t]*\\[(x|X| )?]/m, function () {\r\n          var otp = '<input type=\"checkbox\" disabled style=\"margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;\"';\r\n          if (checked) {\r\n            otp += ' checked';\r\n          }\r\n          otp += '>';\r\n          return otp;\r\n        });\r\n      }\r\n      // m1 - Leading line or\r\n      // Has a double return (multi paragraph) or\r\n      // Has sublist\r\n      if (m1 || (item.search(/\\n{2,}/) > -1)) {\r\n        item = showdown.subParser('githubCodeBlocks')(item, options, globals);\r\n        item = showdown.subParser('blockGamut')(item, options, globals);\r\n      } else {\r\n        // Recursion for sub-lists:\r\n        item = showdown.subParser('lists')(item, options, globals);\r\n        item = item.replace(/\\n$/, ''); // chomp(item)\r\n        if (isParagraphed) {\r\n          item = showdown.subParser('paragraphs')(item, options, globals);\r\n        } else {\r\n          item = showdown.subParser('spanGamut')(item, options, globals);\r\n        }\r\n      }\r\n      item =  '\\n<li' + bulletStyle + '>' + item + '</li>\\n';\r\n      return item;\r\n    });\r\n\r\n    // attacklab: strip sentinel\r\n    listStr = listStr.replace(/~0/g, '');\r\n\r\n    globals.gListLevel--;\r\n\r\n    if (trimTrailing) {\r\n      listStr = listStr.replace(/\\s+$/, '');\r\n    }\r\n\r\n    return listStr;\r\n  }\r\n\r\n  /**\r\n   * Check and parse consecutive lists (better fix for issue #142)\r\n   * @param {string} list\r\n   * @param {string} listType\r\n   * @param {boolean} trimTrailing\r\n   * @returns {string}\r\n   */\r\n  function parseConsecutiveLists(list, listType, trimTrailing) {\r\n    // check if we caught 2 or more consecutive lists by mistake\r\n    // we use the counterRgx, meaning if listType is UL we look for UL and vice versa\r\n    var counterRxg = (listType === 'ul') ? /^ {0,2}\\d+\\.[ \\t]/gm : /^ {0,2}[*+-][ \\t]/gm,\r\n      subLists = [],\r\n      result = '';\r\n\r\n    if (list.search(counterRxg) !== -1) {\r\n      (function parseCL(txt) {\r\n        var pos = txt.search(counterRxg);\r\n        if (pos !== -1) {\r\n          // slice\r\n          result += '\\n\\n<' + listType + '>' + processListItems(txt.slice(0, pos), !!trimTrailing) + '</' + listType + '>\\n\\n';\r\n\r\n          // invert counterType and listType\r\n          listType = (listType === 'ul') ? 'ol' : 'ul';\r\n          counterRxg = (listType === 'ul') ? /^ {0,2}\\d+\\.[ \\t]/gm : /^ {0,2}[*+-][ \\t]/gm;\r\n\r\n          //recurse\r\n          parseCL(txt.slice(pos));\r\n        } else {\r\n          result += '\\n\\n<' + listType + '>' + processListItems(txt, !!trimTrailing) + '</' + listType + '>\\n\\n';\r\n        }\r\n      })(list);\r\n      for (var i = 0; i < subLists.length; ++i) {\r\n\r\n      }\r\n    } else {\r\n      result = '\\n\\n<' + listType + '>' + processListItems(list, !!trimTrailing) + '</' + listType + '>\\n\\n';\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  // attacklab: add sentinel to hack around khtml/safari bug:\r\n  // http://bugs.webkit.org/show_bug.cgi?id=11231\r\n  text += '~0';\r\n\r\n  // Re-usable pattern to match any entire ul or ol list:\r\n  var wholeList = /^(([ ]{0,3}([*+-]|\\d+[.])[ \\t]+)[^\\r]+?(~0|\\n{2,}(?=\\S)(?![ \\t]*(?:[*+-]|\\d+[.])[ \\t]+)))/gm;\r\n\r\n  if (globals.gListLevel) {\r\n    text = text.replace(wholeList, function (wholeMatch, list, m2) {\r\n      var listType = (m2.search(/[*+-]/g) > -1) ? 'ul' : 'ol';\r\n      return parseConsecutiveLists(list, listType, true);\r\n    });\r\n  } else {\r\n    wholeList = /(\\n\\n|^\\n?)(([ ]{0,3}([*+-]|\\d+[.])[ \\t]+)[^\\r]+?(~0|\\n{2,}(?=\\S)(?![ \\t]*(?:[*+-]|\\d+[.])[ \\t]+)))/gm;\r\n    //wholeList = /(\\n\\n|^\\n?)( {0,3}([*+-]|\\d+\\.)[ \\t]+[\\s\\S]+?)(?=(~0)|(\\n\\n(?!\\t| {2,}| {0,3}([*+-]|\\d+\\.)[ \\t])))/g;\r\n    text = text.replace(wholeList, function (wholeMatch, m1, list, m3) {\r\n\r\n      var listType = (m3.search(/[*+-]/g) > -1) ? 'ul' : 'ol';\r\n      return parseConsecutiveLists(list, listType);\r\n    });\r\n  }\r\n\r\n  // attacklab: strip sentinel\r\n  text = text.replace(/~0/, '');\r\n\r\n  text = globals.converter._dispatch('lists.after', text, options, globals);\r\n  return text;\r\n});\r\n\r\n/**\r\n * Remove one level of line-leading tabs or spaces\r\n */\r\nshowdown.subParser('outdent', function (text) {\r\n  'use strict';\r\n\r\n  // attacklab: hack around Konqueror 3.5.4 bug:\r\n  // \"----------bug\".replace(/^-/g,\"\") == \"bug\"\r\n  text = text.replace(/^(\\t|[ ]{1,4})/gm, '~0'); // attacklab: g_tab_width\r\n\r\n  // attacklab: clean up hack\r\n  text = text.replace(/~0/g, '');\r\n\r\n  return text;\r\n});\r\n\r\n/**\r\n *\r\n */\r\nshowdown.subParser('paragraphs', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('paragraphs.before', text, options, globals);\r\n  // Strip leading and trailing lines:\r\n  text = text.replace(/^\\n+/g, '');\r\n  text = text.replace(/\\n+$/g, '');\r\n\r\n  var grafs = text.split(/\\n{2,}/g),\r\n      grafsOut = [],\r\n      end = grafs.length; // Wrap <p> tags\r\n\r\n  for (var i = 0; i < end; i++) {\r\n    var str = grafs[i];\r\n    // if this is an HTML marker, copy it\r\n    if (str.search(/~(K|G)(\\d+)\\1/g) >= 0) {\r\n      grafsOut.push(str);\r\n    } else {\r\n      str = showdown.subParser('spanGamut')(str, options, globals);\r\n      str = str.replace(/^([ \\t]*)/g, '<p>');\r\n      str += '</p>';\r\n      grafsOut.push(str);\r\n    }\r\n  }\r\n\r\n  /** Unhashify HTML blocks */\r\n  end = grafsOut.length;\r\n  for (i = 0; i < end; i++) {\r\n    var blockText = '',\r\n        grafsOutIt = grafsOut[i],\r\n        codeFlag = false;\r\n    // if this is a marker for an html block...\r\n    while (grafsOutIt.search(/~(K|G)(\\d+)\\1/) >= 0) {\r\n      var delim = RegExp.$1,\r\n          num   = RegExp.$2;\r\n\r\n      if (delim === 'K') {\r\n        blockText = globals.gHtmlBlocks[num];\r\n      } else {\r\n        // we need to check if ghBlock is a false positive\r\n        if (codeFlag) {\r\n          // use encoded version of all text\r\n          blockText = showdown.subParser('encodeCode')(globals.ghCodeBlocks[num].text);\r\n        } else {\r\n          blockText = globals.ghCodeBlocks[num].codeblock;\r\n        }\r\n      }\r\n      blockText = blockText.replace(/\\$/g, '$$$$'); // Escape any dollar signs\r\n\r\n      grafsOutIt = grafsOutIt.replace(/(\\n\\n)?~(K|G)\\d+\\2(\\n\\n)?/, blockText);\r\n      // Check if grafsOutIt is a pre->code\r\n      if (/^<pre\\b[^>]*>\\s*<code\\b[^>]*>/.test(grafsOutIt)) {\r\n        codeFlag = true;\r\n      }\r\n    }\r\n    grafsOut[i] = grafsOutIt;\r\n  }\r\n  text = grafsOut.join('\\n\\n');\r\n  // Strip leading and trailing lines:\r\n  text = text.replace(/^\\n+/g, '');\r\n  text = text.replace(/\\n+$/g, '');\r\n  return globals.converter._dispatch('paragraphs.after', text, options, globals);\r\n});\r\n\r\n/**\r\n * Run extension\r\n */\r\nshowdown.subParser('runExtension', function (ext, text, options, globals) {\r\n  'use strict';\r\n\r\n  if (ext.filter) {\r\n    text = ext.filter(text, globals.converter, options);\r\n\r\n  } else if (ext.regex) {\r\n    // TODO remove this when old extension loading mechanism is deprecated\r\n    var re = ext.regex;\r\n    if (!re instanceof RegExp) {\r\n      re = new RegExp(re, 'g');\r\n    }\r\n    text = text.replace(re, ext.replace);\r\n  }\r\n\r\n  return text;\r\n});\r\n\r\n/**\r\n * These are all the transformations that occur *within* block-level\r\n * tags like paragraphs, headers, and list items.\r\n */\r\nshowdown.subParser('spanGamut', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  text = globals.converter._dispatch('spanGamut.before', text, options, globals);\r\n  text = showdown.subParser('codeSpans')(text, options, globals);\r\n  text = showdown.subParser('escapeSpecialCharsWithinTagAttributes')(text, options, globals);\r\n  text = showdown.subParser('encodeBackslashEscapes')(text, options, globals);\r\n\r\n  // Process anchor and image tags. Images must come first,\r\n  // because ![foo][f] looks like an anchor.\r\n  text = showdown.subParser('images')(text, options, globals);\r\n  text = showdown.subParser('anchors')(text, options, globals);\r\n\r\n  // Make links out of things like `<http://example.com/>`\r\n  // Must come after _DoAnchors(), because you can use < and >\r\n  // delimiters in inline links like [this](<url>).\r\n  text = showdown.subParser('autoLinks')(text, options, globals);\r\n  text = showdown.subParser('encodeAmpsAndAngles')(text, options, globals);\r\n  text = showdown.subParser('italicsAndBold')(text, options, globals);\r\n  text = showdown.subParser('strikethrough')(text, options, globals);\r\n\r\n  // Do hard breaks:\r\n  text = text.replace(/  +\\n/g, ' <br />\\n');\r\n\r\n  text = globals.converter._dispatch('spanGamut.after', text, options, globals);\r\n  return text;\r\n});\r\n\r\nshowdown.subParser('strikethrough', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  if (options.strikethrough) {\r\n    text = globals.converter._dispatch('strikethrough.before', text, options, globals);\r\n    text = text.replace(/(?:~T){2}([\\s\\S]+?)(?:~T){2}/g, '<del>$1</del>');\r\n    text = globals.converter._dispatch('strikethrough.after', text, options, globals);\r\n  }\r\n\r\n  return text;\r\n});\r\n\r\n/**\r\n * Strip any lines consisting only of spaces and tabs.\r\n * This makes subsequent regexs easier to write, because we can\r\n * match consecutive blank lines with /\\n+/ instead of something\r\n * contorted like /[ \\t]*\\n+/\r\n */\r\nshowdown.subParser('stripBlankLines', function (text) {\r\n  'use strict';\r\n  return text.replace(/^[ \\t]+$/mg, '');\r\n});\r\n\r\n/**\r\n * Strips link definitions from text, stores the URLs and titles in\r\n * hash references.\r\n * Link defs are in the form: ^[id]: url \"optional title\"\r\n *\r\n * ^[ ]{0,3}\\[(.+)\\]: // id = $1  attacklab: g_tab_width - 1\r\n * [ \\t]*\r\n * \\n?                  // maybe *one* newline\r\n * [ \\t]*\r\n * <?(\\S+?)>?          // url = $2\r\n * [ \\t]*\r\n * \\n?                // maybe one newline\r\n * [ \\t]*\r\n * (?:\r\n * (\\n*)              // any lines skipped = $3 attacklab: lookbehind removed\r\n * [\"(]\r\n * (.+?)              // title = $4\r\n * [\")]\r\n * [ \\t]*\r\n * )?                 // title is optional\r\n * (?:\\n+|$)\r\n * /gm,\r\n * function(){...});\r\n *\r\n */\r\nshowdown.subParser('stripLinkDefinitions', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  var regex = /^ {0,3}\\[(.+)]:[ \\t]*\\n?[ \\t]*<?(\\S+?)>?(?: =([*\\d]+[A-Za-z%]{0,4})x([*\\d]+[A-Za-z%]{0,4}))?[ \\t]*\\n?[ \\t]*(?:(\\n*)[\"|'(](.+?)[\"|')][ \\t]*)?(?:\\n+|(?=~0))/gm;\r\n\r\n  // attacklab: sentinel workarounds for lack of \\A and \\Z, safari\\khtml bug\r\n  text += '~0';\r\n\r\n  text = text.replace(regex, function (wholeMatch, linkId, url, width, height, blankLines, title) {\r\n    linkId = linkId.toLowerCase();\r\n    globals.gUrls[linkId] = showdown.subParser('encodeAmpsAndAngles')(url);  // Link IDs are case-insensitive\r\n\r\n    if (blankLines) {\r\n      // Oops, found blank lines, so it's not a title.\r\n      // Put back the parenthetical statement we stole.\r\n      return blankLines + title;\r\n\r\n    } else {\r\n      if (title) {\r\n        globals.gTitles[linkId] = title.replace(/\"|'/g, '&quot;');\r\n      }\r\n      if (options.parseImgDimensions && width && height) {\r\n        globals.gDimensions[linkId] = {\r\n          width:  width,\r\n          height: height\r\n        };\r\n      }\r\n    }\r\n    // Completely remove the definition from the text\r\n    return '';\r\n  });\r\n\r\n  // attacklab: strip sentinel\r\n  text = text.replace(/~0/, '');\r\n\r\n  return text;\r\n});\r\n\r\nshowdown.subParser('tables', function (text, options, globals) {\r\n  'use strict';\r\n\r\n  if (!options.tables) {\r\n    return text;\r\n  }\r\n\r\n  var tableRgx = /^[ \\t]{0,3}\\|?.+\\|.+\\n[ \\t]{0,3}\\|?[ \\t]*:?[ \\t]*(?:-|=){2,}[ \\t]*:?[ \\t]*\\|[ \\t]*:?[ \\t]*(?:-|=){2,}[\\s\\S]+?(?:\\n\\n|~0)/gm;\r\n\r\n  function parseStyles(sLine) {\r\n    if (/^:[ \\t]*--*$/.test(sLine)) {\r\n      return ' style=\"text-align:left;\"';\r\n    } else if (/^--*[ \\t]*:[ \\t]*$/.test(sLine)) {\r\n      return ' style=\"text-align:right;\"';\r\n    } else if (/^:[ \\t]*--*[ \\t]*:$/.test(sLine)) {\r\n      return ' style=\"text-align:center;\"';\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  function parseHeaders(header, style) {\r\n    var id = '';\r\n    header = header.trim();\r\n    if (options.tableHeaderId) {\r\n      id = ' id=\"' + header.replace(/ /g, '_').toLowerCase() + '\"';\r\n    }\r\n    header = showdown.subParser('spanGamut')(header, options, globals);\r\n\r\n    return '<th' + id + style + '>' + header + '</th>\\n';\r\n  }\r\n\r\n  function parseCells(cell, style) {\r\n    var subText = showdown.subParser('spanGamut')(cell, options, globals);\r\n    return '<td' + style + '>' + subText + '</td>\\n';\r\n  }\r\n\r\n  function buildTable(headers, cells) {\r\n    var tb = '<table>\\n<thead>\\n<tr>\\n',\r\n        tblLgn = headers.length;\r\n\r\n    for (var i = 0; i < tblLgn; ++i) {\r\n      tb += headers[i];\r\n    }\r\n    tb += '</tr>\\n</thead>\\n<tbody>\\n';\r\n\r\n    for (i = 0; i < cells.length; ++i) {\r\n      tb += '<tr>\\n';\r\n      for (var ii = 0; ii < tblLgn; ++ii) {\r\n        tb += cells[i][ii];\r\n      }\r\n      tb += '</tr>\\n';\r\n    }\r\n    tb += '</tbody>\\n</table>\\n';\r\n    return tb;\r\n  }\r\n\r\n  text = globals.converter._dispatch('tables.before', text, options, globals);\r\n\r\n  text = text.replace(tableRgx, function (rawTable) {\r\n\r\n    var i, tableLines = rawTable.split('\\n');\r\n\r\n    // strip wrong first and last column if wrapped tables are used\r\n    for (i = 0; i < tableLines.length; ++i) {\r\n      if (/^[ \\t]{0,3}\\|/.test(tableLines[i])) {\r\n        tableLines[i] = tableLines[i].replace(/^[ \\t]{0,3}\\|/, '');\r\n      }\r\n      if (/\\|[ \\t]*$/.test(tableLines[i])) {\r\n        tableLines[i] = tableLines[i].replace(/\\|[ \\t]*$/, '');\r\n      }\r\n    }\r\n\r\n    var rawHeaders = tableLines[0].split('|').map(function (s) { return s.trim();}),\r\n        rawStyles = tableLines[1].split('|').map(function (s) { return s.trim();}),\r\n        rawCells = [],\r\n        headers = [],\r\n        styles = [],\r\n        cells = [];\r\n\r\n    tableLines.shift();\r\n    tableLines.shift();\r\n\r\n    for (i = 0; i < tableLines.length; ++i) {\r\n      if (tableLines[i].trim() === '') {\r\n        continue;\r\n      }\r\n      rawCells.push(\r\n        tableLines[i]\r\n          .split('|')\r\n          .map(function (s) {\r\n            return s.trim();\r\n          })\r\n      );\r\n    }\r\n\r\n    if (rawHeaders.length < rawStyles.length) {\r\n      return rawTable;\r\n    }\r\n\r\n    for (i = 0; i < rawStyles.length; ++i) {\r\n      styles.push(parseStyles(rawStyles[i]));\r\n    }\r\n\r\n    for (i = 0; i < rawHeaders.length; ++i) {\r\n      if (showdown.helper.isUndefined(styles[i])) {\r\n        styles[i] = '';\r\n      }\r\n      headers.push(parseHeaders(rawHeaders[i], styles[i]));\r\n    }\r\n\r\n    for (i = 0; i < rawCells.length; ++i) {\r\n      var row = [];\r\n      for (var ii = 0; ii < headers.length; ++ii) {\r\n        if (showdown.helper.isUndefined(rawCells[i][ii])) {\r\n\r\n        }\r\n        row.push(parseCells(rawCells[i][ii], styles[ii]));\r\n      }\r\n      cells.push(row);\r\n    }\r\n\r\n    return buildTable(headers, cells);\r\n  });\r\n\r\n  text = globals.converter._dispatch('tables.after', text, options, globals);\r\n\r\n  return text;\r\n});\r\n\r\n/**\r\n * Swap back in all the special characters we've hidden.\r\n */\r\nshowdown.subParser('unescapeSpecialChars', function (text) {\r\n  'use strict';\r\n\r\n  text = text.replace(/~E(\\d+)E/g, function (wholeMatch, m1) {\r\n    var charCodeToReplace = parseInt(m1);\r\n    return String.fromCharCode(charCodeToReplace);\r\n  });\r\n  return text;\r\n});\r\nmodule.exports = showdown;\r\n/*eslint-enable */\r\n"]}