{"version":3,"sources":["pages/grade/grade.js"],"names":["app","getApp","useUrl","require","Page","data","title","text_ph","upPhotoList","currentStar","comment","chooseArr","checkStatus","choosetip","e","index","currentTarget","dataset","choose","setData","chooseStar","star","upPhoto","that","length","wx","showToast","icon","duration","chooseImage","count","sizeType","sourceType","success","res","tempFilePaths","temp","push","showImage","previewImage","current","imgsrc","urls","delphoto","splice","indexOf","delsrc","setMoney","useMoney","detail","value","gradeBtn","userCommentText","showModal","content","showCancel","confirmText","obj","url","serviceUrl","post_comment","session_key","getStorageSync","s_id","sId","level","o_id","oId","desc","complete","switchTab","requestInfo","lid","item","id","obj2","post_label_comment","l_id","console","log","sendPhoto","uploadFile","textBlur","text","replace","changbox","getTips","params","user_flow_comment","onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":";;AAAA;AACA,IAAMA,MAAMC,QAAZ;AACA,IAAMC,SAASC,QAAQ,qBAAR,CAAf;AACA;AACAC,KAAK;AACH;;;AAGAC,QAAM;AACJC,WAAO,OADH;AAEJC,aAAS,mBAFL;AAGJC,iBAAa,EAHT;AAIJC,iBAAa,CAJT;AAKJ;AACAC,aAAS,EANL;AAOJC,eAAW,EAPP;AAQJC,iBAAa;AART,GAJH;AAcH;;;;AAIAC,WAlBG,qBAkBQC,CAlBR,EAkBW;AACZ,QAAIC,QAAQD,EAAEE,aAAF,CAAgBC,OAAhB,CAAwBC,MAApC;AACA,SAAKb,IAAL,CAAUM,SAAV,CAAoBI,KAApB,IAA6B,CAAC,KAAKV,IAAL,CAAUM,SAAV,CAAoBI,KAApB,CAA9B;AACA,SAAKI,OAAL,CAAa;AACXR,iBAAW,KAAKN,IAAL,CAAUM;AADV,KAAb;AAGD,GAxBE;;AAyBH;;;;AAIAS,YA7BG,sBA6BSN,CA7BT,EA6BY;AACb,SAAKK,OAAL,CAAa;AACXV,mBAAaK,EAAEE,aAAF,CAAgBC,OAAhB,CAAwBI;AAD1B,KAAb;AAGD,GAjCE;;AAkCH;;;AAGAC,SArCG,qBAqCQ;AACT,QAAIC,OAAO,IAAX;AACA,QAAIA,KAAKlB,IAAL,CAAUG,WAAV,CAAsBgB,MAAtB,IAAgC,CAApC,EAAuC;AACrC,aAAOC,GAAGC,SAAH,CAAa;AAClBpB,eAAO,QADW;AAElBqB,cAAM,SAFY;AAGlBC,kBAAU;AAHQ,OAAb,CAAP;AAKD;AACDH,OAAGI,WAAH,CAAe;AACbC,aAAO,CADM,EACH;AACVC,gBAAU,CAAC,UAAD,EAAa,YAAb,CAFG,EAEyB;AACtCC,kBAAY,CAAC,OAAD,EAAU,QAAV,CAHC,EAGoB;AACjCC,eAAS,iBAAUC,GAAV,EAAe;AACtB;AACA,YAAIC,gBAAgBD,IAAIC,aAAxB;AACA,YAAIC,OAAOD,cAAc,CAAd,CAAX;AACAZ,aAAKlB,IAAL,CAAUG,WAAV,CAAsB6B,IAAtB,CAA2BD,IAA3B;AACAb,aAAKJ,OAAL,CAAa;AACXX,uBAAae,KAAKlB,IAAL,CAAUG;AADZ,SAAb;AAGD;AAZY,KAAf;AAcD,GA5DE;;AA6DH;;;AAGA8B,WAhEG,qBAgEQxB,CAhER,EAgEW;AACZ,QAAIS,OAAO,IAAX;AACAE,OAAGc,YAAH,CAAgB;AACdC,eAAS1B,EAAEE,aAAF,CAAgBC,OAAhB,CAAwBwB,MADnB,EAC2B;AACzCC,YAAMnB,KAAKlB,IAAL,CAAUG,WAFF,CAEc;AAFd,KAAhB;AAID,GAtEE;;AAuEH;;;;AAIAmC,UA3EG,oBA2EO7B,CA3EP,EA2EU;AACX,QAAIS,OAAO,IAAX;AACAA,SAAKlB,IAAL,CAAUG,WAAV,CAAsBoC,MAAtB,CAA6BrB,KAAKlB,IAAL,CAAUG,WAAV,CAAsBqC,OAAtB,CAA8B/B,EAAEE,aAAF,CAAgBC,OAAhB,CAAwB6B,MAAtD,CAA7B,EAA4F,CAA5F;AACA,SAAK3B,OAAL,CAAa;AACXX,mBAAae,KAAKlB,IAAL,CAAUG;AADZ,KAAb;AAGD,GAjFE;;AAkFH;;;;AAIAuC,UAtFG,oBAsFOjC,CAtFP,EAsFU;AACX,SAAKK,OAAL,CAAa;AACX6B,gBAAUlC,EAAEmC,MAAF,CAASC;AADR,KAAb;AAGD,GA1FE;;AA2FH;;;AAGAC,UA9FG,sBA8FS;AACV,QAAI5B,OAAO,IAAX;AACA,QAAI,CAACA,KAAKlB,IAAL,CAAU+C,eAAf,EAAgC;AAC9B,aAAO3B,GAAG4B,SAAH,CAAa;AAClB/C,eAAO,MADW;AAElBgD,iBAAS,UAFS;AAGlBC,oBAAY,KAHM;AAIlBC,qBAAa;AAJK,OAAb,CAAP;AAMD;AACD,QAAIC,MAAM;AACRC,WAAKxD,OAAOyD,UAAP,CAAkBC,YADf;AAERvD,YAAM;AACJwD,qBAAapC,GAAGqC,cAAH,CAAkB,aAAlB,CADT;AAEJC,cAAMxC,KAAKlB,IAAL,CAAU2D,GAFZ;AAGJC,eAAO1C,KAAKlB,IAAL,CAAUI,WAAV,GAAwB,CAAxB,GAA4B,CAH/B;AAIJyD,cAAM3C,KAAKlB,IAAL,CAAU8D,GAJZ;AAKJC,cAAM7C,KAAKlB,IAAL,CAAU+C;AALZ,OAFE;AASRnB,aATQ,qBASG;AACT;AACAR,WAAG4B,SAAH,CAAa;AACX/C,iBAAO,MADI;AAEXgD,mBAAS,MAFE;AAGXC,sBAAY,KAHD;AAIXc,kBAJW,sBAIC;AACV5C,eAAG6C,SAAH,CAAa;AACXZ,mBAAK;AADM,aAAb;AAGD;AARU,SAAb;AAUD;AArBO,KAAV;AAuBA1D,QAAIuE,WAAJ,CAAgBd,GAAhB;AACA,QAAIlC,KAAKlB,IAAL,CAAUM,SAAV,CAAoBa,MAApB,KAA+B,CAAnC,EAAsC;AACtC,QAAIgD,MAAM,EAAV;AACA,SAAK,IAAIC,IAAT,IAAiBlD,KAAKlB,IAAL,CAAUM,SAA3B,EAAsC;AACpC,UAAIY,KAAKlB,IAAL,CAAUM,SAAV,CAAoB8D,IAApB,CAAJ,EAA+B;AAC7BD,YAAInC,IAAJ,CAASd,KAAKlB,IAAL,CAAUK,OAAV,CAAkB+D,IAAlB,EAAwBC,EAAjC;AACD;AACF;AACD,QAAIF,IAAIhD,MAAJ,KAAe,CAAnB,EAAsB;AACtB,QAAImD,OAAO;AACTjB,WAAKxD,OAAOyD,UAAP,CAAkBiB,kBADd;AAETvE,YAAM;AACJwD,qBAAapC,GAAGqC,cAAH,CAAkB,aAAlB,CADT;AAEJC,cAAMxC,KAAKlB,IAAL,CAAU2D,GAFZ;AAGJC,eAAO1C,KAAKlB,IAAL,CAAUI,WAAV,GAAwB,CAAxB,GAA4B,CAH/B;AAIJoE,cAAML;AAJF,OAFG;AAQTvC,aARS,mBAQAC,GARA,EAQK;AACZ4C,gBAAQC,GAAR,CAAY7C,GAAZ;AACD;AAVQ,KAAX;AAYAlC,QAAIuE,WAAJ,CAAgBI,IAAhB;AACA;AACA;AACA;AACD,GAxJE;;AAyJH;;;AAGAK,WA5JG,uBA4JU;AACXvD,OAAGwD,UAAH,CAAc;AACZvB,WAAK;AADO,KAAd;AAGD,GAhKE;;AAiKH;;;;AAIAwB,UArKG,oBAqKOpE,CArKP,EAqKU;AACX;AACA,QAAIqE,OAAOrE,EAAEmC,MAAF,CAASC,KAAT,CAAekC,OAAf,CAAuB,MAAvB,EAA+B,EAA/B,CAAX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAKjE,OAAL,CAAa;AACXiC,uBAAiB+B;AADN,KAAb;AAGD,GAlLE;;AAmLH;;;;AAIAE,UAvLG,sBAuLS;AACV,SAAKlE,OAAL,CAAa;AACXP,mBAAa,CAAC,KAAKP,IAAL,CAAUO;AADb,KAAb;AAGD,GA3LE;;AA4LH;;;;AAIA0E,SAhMG,mBAgMMC,MAhMN,EAgMc;AACf,QAAIhE,OAAO,IAAX;AACA,QAAIkC,MAAM;AACRC,WAAKxD,OAAOyD,UAAP,CAAkB6B,iBADf;AAERnF,YAAM;AACJwD,qBAAapC,GAAGqC,cAAH,CAAkB,aAAlB,CADT;AAEJC,cAAMwB,OAAOxB;AAFT,OAFE;AAMR9B,aANQ,mBAMCC,GAND,EAMM;AACZX,aAAKJ,OAAL,CAAa;AACXT,mBAASwB,IAAI7B,IAAJ,CAASA;AADP,SAAb;AAGA;AACD;AAXO,KAAV;AAaAL,QAAIuE,WAAJ,CAAgBd,GAAhB;AACD,GAhNE;;AAiNH;;;AAGAgC,QApNG,kBAoNKF,MApNL,EAoNa;AACd,SAAKD,OAAL,CAAaC,MAAb;AACA,SAAKpE,OAAL,CAAa;AACX6C,WAAKuB,OAAOxB,IADD;AAEXI,WAAKoB,OAAOrB;AAFD,KAAb;AAIA;AACD,GA3NE;;;AA6NH;;;AAGAwB,SAhOG,qBAgOQ;AACT;AACD,GAlOE;;;AAoOH;;;AAGAC,QAvOG,oBAuOO;AACR;AACD,GAzOE;;;AA2OH;;;AAGAC,QA9OG,oBA8OO;AACR;AACD,GAhPE;;;AAkPH;;;AAGAC,UArPG,sBAqPS;AACV;AACD,GAvPE;;;AAyPH;;;AAGAC,mBA5PG,+BA4PkB;AACnB;AACD;AA9PE,CAAL","file":"grade.js","sourcesContent":["// 获取全局应用程序实例对象\r\nconst app = getApp()\r\nconst useUrl = require('../../utils/service')\r\n// 创建页面实例对象\r\nPage({\r\n  /**\r\n   * 页面的初始数据\r\n   */\r\n  data: {\r\n    title: 'grade',\r\n    text_ph: '菜品口味如何，服务如何？环境如何？',\r\n    upPhotoList: [],\r\n    currentStar: 4,\r\n    // comment: ['服务态度好', '分量足', '热情周到', '味道赞', '长得帅有食欲', '人很nice'],\r\n    comment: [],\r\n    chooseArr: [],\r\n    checkStatus: false\r\n  },\r\n  /**\r\n   * 改变标签选择\r\n   * @param e\r\n   */\r\n  choosetip (e) {\r\n    let index = e.currentTarget.dataset.choose\r\n    this.data.chooseArr[index] = !this.data.chooseArr[index]\r\n    this.setData({\r\n      chooseArr: this.data.chooseArr\r\n    })\r\n  },\r\n  /**\r\n   * 星星打分\r\n   * @param e\r\n   */\r\n  chooseStar (e) {\r\n    this.setData({\r\n      currentStar: e.currentTarget.dataset.star\r\n    })\r\n  },\r\n  /**\r\n   * 用户上传图片\r\n   */\r\n  upPhoto () {\r\n    let that = this\r\n    if (that.data.upPhotoList.length >= 6) {\r\n      return wx.showToast({\r\n        title: '最多6张图片',\r\n        icon: 'success',\r\n        duration: 2000\r\n      })\r\n    }\r\n    wx.chooseImage({\r\n      count: 1, // 默认9\r\n      sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有\r\n      sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有\r\n      success: function (res) {\r\n        // 返回选定照片的本地文件路径列表，tempFilePath可以作为img标签的src属性显示图片\r\n        var tempFilePaths = res.tempFilePaths\r\n        let temp = tempFilePaths[0]\r\n        that.data.upPhotoList.push(temp)\r\n        that.setData({\r\n          upPhotoList: that.data.upPhotoList\r\n        })\r\n      }\r\n    })\r\n  },\r\n  /**\r\n   * 图片展示\r\n   */\r\n  showImage (e) {\r\n    let that = this\r\n    wx.previewImage({\r\n      current: e.currentTarget.dataset.imgsrc, // 当前显示图片的http链接\r\n      urls: that.data.upPhotoList // 需要预览的图片http链接列表\r\n    })\r\n  },\r\n  /**\r\n   * 删除当前图片\r\n   * @param e\r\n   */\r\n  delphoto (e) {\r\n    let that = this\r\n    that.data.upPhotoList.splice(that.data.upPhotoList.indexOf(e.currentTarget.dataset.delsrc), 1)\r\n    this.setData({\r\n      upPhotoList: that.data.upPhotoList\r\n    })\r\n  },\r\n  /**\r\n   * 设置消费金额\r\n   * @param e\r\n   */\r\n  setMoney (e) {\r\n    this.setData({\r\n      useMoney: e.detail.value\r\n    })\r\n  },\r\n  /**\r\n   * 提交评论信息\r\n   */\r\n  gradeBtn () {\r\n    let that = this\r\n    if (!that.data.userCommentText) {\r\n      return wx.showModal({\r\n        title: '评论无效',\r\n        content: '请输入有效的评论',\r\n        showCancel: false,\r\n        confirmText: '我知道了'\r\n      })\r\n    }\r\n    let obj = {\r\n      url: useUrl.serviceUrl.post_comment,\r\n      data: {\r\n        session_key: wx.getStorageSync('session_key'),\r\n        s_id: that.data.sId,\r\n        level: that.data.currentStar * 1 + 1,\r\n        o_id: that.data.oId,\r\n        desc: that.data.userCommentText\r\n      },\r\n      success () {\r\n        // console.log(res)\r\n        wx.showModal({\r\n          title: '评论商家',\r\n          content: '评论成功',\r\n          showCancel: false,\r\n          complete () {\r\n            wx.switchTab({\r\n              url: '../index/index'\r\n            })\r\n          }\r\n        })\r\n      }\r\n    }\r\n    app.requestInfo(obj)\r\n    if (that.data.chooseArr.length === 0) return\r\n    let lid = []\r\n    for (var item in that.data.chooseArr) {\r\n      if (that.data.chooseArr[item]) {\r\n        lid.push(that.data.comment[item].id)\r\n      }\r\n    }\r\n    if (lid.length === 0) return\r\n    let obj2 = {\r\n      url: useUrl.serviceUrl.post_label_comment,\r\n      data: {\r\n        session_key: wx.getStorageSync('session_key'),\r\n        s_id: that.data.sId,\r\n        level: that.data.currentStar * 1 + 1,\r\n        l_id: lid\r\n      },\r\n      success (res) {\r\n        console.log(res)\r\n      }\r\n    }\r\n    app.requestInfo(obj2)\r\n    // wx.switchTab({\r\n    //   url: '../index/index'\r\n    // })\r\n  },\r\n  /**\r\n   * 上传图片\r\n   */\r\n  sendPhoto () {\r\n    wx.uploadFile({\r\n      url: ''\r\n    })\r\n  },\r\n  /**\r\n   * 输入文字\r\n   * @param e\r\n   */\r\n  textBlur (e) {\r\n    // console.log(e)\r\n    let text = e.detail.value.replace(/\\s+/g, '')\r\n    // if (text === '') {\r\n    //   return wx.showModal({\r\n    //     title: '评论',\r\n    //     content: '请输入有效的评论',\r\n    //     showCancel: false\r\n    //   })\r\n    // }\r\n    this.setData({\r\n      userCommentText: text\r\n    })\r\n  },\r\n  /**\r\n   * checkbox 选项\r\n   * @param e\r\n   */\r\n  changbox () {\r\n    this.setData({\r\n      checkStatus: !this.data.checkStatus\r\n    })\r\n  },\r\n  /**\r\n   * 获取评论标签\r\n   * @param params\r\n   */\r\n  getTips (params) {\r\n    let that = this\r\n    let obj = {\r\n      url: useUrl.serviceUrl.user_flow_comment,\r\n      data: {\r\n        session_key: wx.getStorageSync('session_key'),\r\n        s_id: params.s_id\r\n      },\r\n      success (res) {\r\n        that.setData({\r\n          comment: res.data.data\r\n        })\r\n        // console.log(res)\r\n      }\r\n    }\r\n    app.requestInfo(obj)\r\n  },\r\n  /**\r\n   * 生命周期函数--监听页面加载\r\n   */\r\n  onLoad (params) {\r\n    this.getTips(params)\r\n    this.setData({\r\n      sId: params.s_id,\r\n      oId: params.o_id\r\n    })\r\n    // TODO: onLoad\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面初次渲染完成\r\n   */\r\n  onReady () {\r\n    // TODO: onReady\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面显示\r\n   */\r\n  onShow () {\r\n    // TODO: onShow\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面隐藏\r\n   */\r\n  onHide () {\r\n    // TODO: onHide\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面卸载\r\n   */\r\n  onUnload () {\r\n    // TODO: onUnload\r\n  },\r\n\r\n  /**\r\n   * 页面相关事件处理函数--监听用户下拉动作\r\n   */\r\n  onPullDownRefresh () {\r\n    // TODO: onPullDownRefresh\r\n  }\r\n})\r\n"]}