{"version":3,"sources":["pages/index/index.js"],"names":["app","getApp","useUrl","require","Page","data","title","userInfo","userSite","navList","navTitle","navIcon","hotShop","nearShop","imgUrls","star","chooseLocation","that","wx","success","res","setData","latitude","longitude","name","length","address","goSearch","navigateTo","url","getLocation","type","setStorageSync","obj","serviceUrl","weizhi","session_key","getStorageSync","requestInfo","getNearShop","getHotShop","hot_shop","fujin_shop","getAd","ad","index","push","thumb","onLoad","sessionKey","mainLogin","onReady","console","log","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"index.js","sourcesContent":["// 获取全局应用程序实例对象\r\nconst app = getApp()\r\nconst useUrl = require('../../utils/service')\r\n// 创建页面实例对象\r\nPage({\r\n  /**\r\n   * 页面的初始数据\r\n   */\r\n  data: {\r\n    title: 'index',\r\n    userInfo: null,\r\n    userSite: '定位中',\r\n    navList: [\r\n      {\r\n        navTitle: '排队取号',\r\n        navIcon: 'iconfont icon-shalou'\r\n      },\r\n      {\r\n        navTitle: '预约订座',\r\n        navIcon: 'iconfont icon-chuliyuyue'\r\n      },\r\n      {\r\n        navTitle: '扫描单号',\r\n        navIcon: 'iconfont icon-erweima'\r\n      }\r\n    ],\r\n    hotShop: [\r\n      // {\r\n      //   shopImg: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\r\n      //   shopName: '青花椒砂锅鱼'\r\n      // },\r\n      // {\r\n      //   shopImg: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\r\n      //   shopName: '青花椒砂锅鱼'\r\n      // },\r\n      // {\r\n      //   shopImg: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\r\n      //   shopName: '青花椒砂锅鱼'\r\n      // },\r\n      // {\r\n      //   shopImg: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\r\n      //   shopName: '青花椒砂锅鱼'\r\n      // },\r\n      // {\r\n      //   shopImg: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\r\n      //   shopName: '青花椒砂锅鱼'\r\n      // },\r\n      // {\r\n      //   shopImg: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\r\n      //   shopName: '青花椒砂锅鱼'\r\n      // }\r\n    ],\r\n    nearShop: [\r\n      // {\r\n      //   img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\r\n      //   name: '青花椒砂锅鱼',\r\n      //   price: '30',\r\n      //   kind: '中国菜',\r\n      //   distance: '8.6km',\r\n      //   status: '无需排队',\r\n      //   grade: 'five-star'\r\n      // },\r\n      // {\r\n      //   img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\r\n      //   name: '青花椒砂锅鱼',\r\n      //   price: '30',\r\n      //   kind: '中国菜',\r\n      //   status: '无需排队',\r\n      //   grade: 'four-star'\r\n      // },\r\n      // {\r\n      //   img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\r\n      //   name: '青花椒砂锅鱼',\r\n      //   price: '128',\r\n      //   kind: '中国菜',\r\n      //   status: '无需排队',\r\n      //   grade: 'one-star'\r\n      // }\r\n    ],\r\n    imgUrls: [\r\n      // 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\r\n      // 'http://img06.tooopen.com/images/20160818/tooopen_sy_175866434296.jpg',\r\n      // 'http://img06.tooopen.com/images/20160818/tooopen_sy_175833047715.jpg'\r\n    ],\r\n    star: ['zero-star', 'one-star', 'two-star', 'three-star', 'four-star', 'five-star']\r\n  },\r\n  /**\r\n   * 用户选择位置\r\n   * @returns {boolean}\r\n   */\r\n  chooseLocation () {\r\n    // console.log(1)\r\n    let that = this\r\n    wx.chooseLocation({\r\n      success (res) {\r\n        // console.log(res)\r\n        that.setData({\r\n          latitude: res.latitude,\r\n          longitude: res.longitude\r\n        })\r\n        that.nearShop(res.longitude, res.latitude)\r\n        if (res.name.length <= 0) {\r\n          return that.setData({\r\n            userSite: res.address\r\n          })\r\n        }\r\n        that.setData({\r\n          userSite: res.name\r\n        })\r\n      }\r\n    })\r\n  },\r\n  /**\r\n   * 用户搜索\r\n   */\r\n  goSearch () {\r\n    wx.navigateTo({\r\n      url: '../search/search'\r\n    })\r\n  },\r\n  /**\r\n   * 获取用户地理位置\r\n   */\r\n  getLocation () {\r\n    let that = this\r\n    wx.getLocation({\r\n      type: 'gcj02',\r\n      success (res) {\r\n        // console.log(res)\r\n        that.setData({\r\n          longitude: res.longitude,\r\n          latitude: res.latitude\r\n        })\r\n        wx.setStorageSync('userSite', {longitude: res.longitude, latitude: res.latitude})\r\n        let obj = {\r\n          url: useUrl.serviceUrl.weizhi,\r\n          data: {\r\n            session_key: wx.getStorageSync('session_key'),\r\n            latitude: res.latitude,\r\n            longitude: res.longitude\r\n          },\r\n          success (res) {\r\n            // console.log(res)\r\n            that.setData({\r\n              userSite: res.data.data.address\r\n            })\r\n          }\r\n        }\r\n        app.requestInfo(obj)\r\n        that.getNearShop(res.longitude, res.latitude)\r\n        // 获取用户当前位置地名\r\n        return\r\n        // todo delete return\r\n        // let obj = {\r\n        //   url: useUrl.serviceUrl.fujin_shop,\r\n        //   data: {\r\n        //     latitud: res.latitude,\r\n        //     longitude: res.longitude,\r\n        //     session_key: wx.getStorageSync('session_key')\r\n        //   },\r\n        //   success (res) {\r\n        //     console.log(res)\r\n        //     that.setData({\r\n        //       userSite: res.data.data\r\n        //     })\r\n        //   }\r\n        // }\r\n        // app.requestInfo(obj)\r\n      }\r\n    })\r\n  },\r\n  /**\r\n   * 获取热门商家\r\n   */\r\n  getHotShop () {\r\n    let that = this\r\n    let obj = {\r\n      url: useUrl.serviceUrl.hot_shop,\r\n      data: {\r\n        session_key: wx.getStorageSync('session_key')\r\n      },\r\n      success (res) {\r\n        // console.log(res)\r\n        that.setData({\r\n          hotShop: res.data.data\r\n        })\r\n      }\r\n    }\r\n    app.requestInfo(obj)\r\n  },\r\n  /**\r\n   * 获取附近商家\r\n   */\r\n  getNearShop (longitude, latitude) {\r\n    let that = this\r\n    let obj = {\r\n      url: useUrl.serviceUrl.fujin_shop,\r\n      data: {\r\n        session_key: wx.getStorageSync('session_key'),\r\n        latitude: latitude,\r\n        longitude: longitude\r\n      },\r\n      success (res) {\r\n        // console.log(res)\r\n        // return\r\n        if (res.data.data.length === 0) return\r\n        that.setData({\r\n          nearShop: res.data.data\r\n        })\r\n      }\r\n    }\r\n    app.requestInfo(obj)\r\n  },\r\n  /**\r\n   * 获取首页轮播图\r\n   */\r\n  getAd () {\r\n    let that = this\r\n    let obj = {\r\n      url: useUrl.serviceUrl.ad,\r\n      data: {\r\n        session_key: wx.getStorageSync('session_key')\r\n      },\r\n      success (res) {\r\n        // console.log(res)\r\n        if (res.data.data.length === 0) return\r\n        let imgUrls = []\r\n        for (var index of res.data.data) {\r\n          // console.log(index)\r\n          imgUrls.push(index.thumb)\r\n        }\r\n        that.setData({\r\n          imgUrls: imgUrls\r\n        })\r\n      }\r\n    }\r\n    app.requestInfo(obj)\r\n  },\r\n  /**\r\n   * 生命周期函数--监听页面加载\r\n   */\r\n  onLoad () {\r\n    let that = this\r\n    var sessionKey = wx.getStorageSync('session_key')\r\n    if (sessionKey) {\r\n      // 有sessionKey\r\n      // 获取用户位置信息\r\n      that.getLocation()\r\n      // 获取人们商家\r\n      that.getHotShop()\r\n      // 获取首页轮播图\r\n      that.getAd()\r\n      // 获取用户信息\r\n      that.setData({\r\n        userInfo: wx.getStorageSync('userInfo')\r\n      })\r\n      // let obj = {\r\n      //   // withCredentials: true,\r\n      //   success (res) {\r\n      //     // console.log(res)\r\n      //     that.setData({\r\n      //       userInfo: res.userInfo\r\n      //     })\r\n      //     // that.data.userInfo = res.userInfo\r\n      //   }\r\n      // }\r\n      // app.getUserInfo(obj)\r\n      // that.getNearshop()\r\n    } else {\r\n      // 没有sessionKey\r\n      app.mainLogin(that, that.getLocation, that.getHotShop, that.getAd)\r\n    }\r\n    // 获取地理位置\r\n\r\n    // console.log(' ---------- onLoad ----------')\r\n    // console.dir(app.data)\r\n    // 读取session_key\r\n    // let session_key = wx.getStorageSync('session_key')\r\n  },\r\n  /**\r\n   * 生命周期函数--监听页面初次渲染完成\r\n   */\r\n  onReady () {\r\n    console.log(' ---------- onReady ----------')\r\n  },\r\n  /**\r\n   * 生命周期函数--监听页面显示\r\n   */\r\n  onShow () {\r\n    // app.getUserInfo()\r\n    //   .then(info => this.setData({ userInfo: info }))\r\n    //   .catch(console.info)\r\n    console.log(' ---------- onShow ----------')\r\n  },\r\n  /**\r\n   * 生命周期函数--监听页面隐藏\r\n   */\r\n  onHide () {\r\n    console.log(' ---------- onHide ----------')\r\n  },\r\n  /**\r\n   * 生命周期函数--监听页面卸载\r\n   */\r\n  onUnload () {\r\n    console.log(' ---------- onUnload ----------')\r\n  },\r\n  /**\r\n   * 页面相关事件处理函数--监听用户下拉动作\r\n   */\r\n  onPullDownRefresh () {\r\n    console.log(' ---------- onPullDownRefresh ----------')\r\n  }\r\n})\r\n"]}