{"version":3,"sources":["pages/payorder/payorder.js"],"names":["app","getApp","useUrl","require","Page","data","title","index","allMoney","order","concessionalChange","e","delMoney","detail","value","parseInt","setData","changeTwoDecimalf","floatvar","fx","parseFloat","isNaN","Math","round","sx","toString","posdecimal","indexOf","length","payMoney","getOrderInfo","params","that","obj","url","serviceUrl","order_info","session_key","wx","getStorageSync","shop_id","s_id","o_id","success","res","coupons","concessional","item","push","amount","use_price","order_price","requestInfo","onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"payorder.js","sourcesContent":["// 获取全局应用程序实例对象\r\nconst app = getApp()\r\nconst useUrl = require('../../utils/service')\r\n// 创建页面实例对象\r\nPage({\r\n  /**\r\n   * 页面的初始数据\r\n   */\r\n  data: {\r\n    title: 'payorder',\r\n    index: 0,\r\n    allMoney: 582.02,\r\n    order: {\r\n      // restaurant: '人马大饭堂',\r\n      // count: 5,\r\n      // number: '20170326122',\r\n      // time: '2017/3/26 13:23:02',\r\n      // goods: [\r\n      //   {\r\n      //     name: '鱼香肉丝',\r\n      //     count: 2,\r\n      //     money: '23.00'\r\n      //   },\r\n      //   {\r\n      //     name: '鱼香肉丝',\r\n      //     count: 2,\r\n      //     money: '23.00'\r\n      //   },\r\n      //   {\r\n      //     name: '鱼香肉丝',\r\n      //     count: 2,\r\n      //     money: '23.00'\r\n      //   },\r\n      //   {\r\n      //     name: '鱼香肉丝',\r\n      //     count: 2,\r\n      //     money: '23.00'\r\n      //   },\r\n      //   {\r\n      //     name: '鱼香肉丝',\r\n      //     count: 2,\r\n      //     money: '23.00'\r\n      //   }\r\n      // ],\r\n      // allMoney: 582.02,\r\n      // concessional: ['不使用优惠券', '满100减20', '满100减30', '满300减10', '满500优惠5折'],\r\n      // delMoney: [0, -20, -30, -100, 0.5]\r\n    }\r\n  },\r\n  /**\r\n   * 优惠券选择\r\n   */\r\n  concessionalChange (e) {\r\n    // console.log(this.data.allMoney + (this.data.order.delMoney[e.detail.value]))\r\n    if (this.data.order.delMoney[e.detail.value] < 1 && this.data.order.delMoney[e.detail.value] > 0) {\r\n      this.data.order.allMoney = this.data.allMoney * this.data.order.delMoney[e.detail.value]\r\n    } else {\r\n      this.data.order.allMoney = (parseInt(this.data.allMoney) + (this.data.order.delMoney[e.detail.value]))\r\n    }\r\n    this.setData({\r\n      index: e.detail.value,\r\n      order: this.data.order\r\n    })\r\n  },\r\n  /**\r\n   * 小数点后两位\r\n   * @param floatvar\r\n   * @returns {*}\r\n   */\r\n  changeTwoDecimalf  (floatvar) {\r\n    var fx = parseFloat(floatvar)\r\n    if (isNaN(fx)) {\r\n      return false\r\n    }\r\n    fx = Math.round(fx * 10000) / 100.00\r\n    var sx = fx.toString()\r\n    var posdecimal = sx.indexOf('.')\r\n    if (posdecimal < 0) {\r\n      posdecimal = sx.length\r\n      sx += '.'\r\n    }\r\n    while (sx.length <= posdecimal + 2) {\r\n      sx += '0'\r\n    }\r\n    return sx\r\n  },\r\n  /**\r\n   * 支付货款\r\n   */\r\n  payMoney () {\r\n    // let obj = {\r\n    //   url: url,\r\n    //   data: {\r\n    //\r\n    //   },\r\n    //   method: 'GET',\r\n    //   success (res) {\r\n    //     // todo 付款流程\r\n    //     // wx.requestPayment({\r\n    //     //   'timeStamp': '',\r\n    //     //   'nonceStr': '',\r\n    //     //   'package': '',\r\n    //     //   'signType': 'MD5',\r\n    //     //   'paySign': '',\r\n    //     //   'success':function(res){\r\n    //     //   },\r\n    //     //   'fail':function(res){\r\n    //     //   }\r\n    //     // })\r\n    //   },\r\n    //   fail (res) {\r\n    //     console.log(res)\r\n    //   }\r\n    // }\r\n    // wx.requset(obj)\r\n  },\r\n  /**\r\n   * 获取订单详情信息\r\n   * @param e\r\n   */\r\n  getOrderInfo (params) {\r\n    let that = this\r\n    let obj = {\r\n      url: useUrl.serviceUrl.order_info,\r\n      data: {\r\n        session_key: wx.getStorageSync('session_key'),\r\n        shop_id: params.s_id,\r\n        o_id: params.o_id\r\n      },\r\n      success (res) {\r\n        // console.log(res)\r\n        let order = res.data.data\r\n        if (order.coupons) {\r\n          order.concessional = order.coupons\r\n          let delMoney = []\r\n          let coupons = []\r\n          for (var item of order.coupons) {\r\n            delMoney.push(parseInt(item.amount) * -1)\r\n            coupons.push('满' + item.use_price + '减' + item.amount + '元')\r\n          }\r\n          order.delMoney = delMoney\r\n          order.allMoney = parseInt(order.order.order_price) + delMoney[0]\r\n          order.coupons = coupons\r\n          return that.setData({\r\n            order: order,\r\n            allMoney: order.order.order_price\r\n          })\r\n        }\r\n        order.allMoney = order.order.order_price\r\n        that.setData({\r\n          order: order,\r\n          allMoney: order.order.order_price\r\n        })\r\n      }\r\n    }\r\n    app.requestInfo(obj)\r\n  },\r\n  /**\r\n   * 生命周期函数--监听页面加载\r\n   */\r\n  onLoad (params) {\r\n    // console.log(e)\r\n    this.getOrderInfo(params)\r\n    // TODO: onLoad\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面初次渲染完成\r\n   */\r\n  onReady () {\r\n    // TODO: onReady\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面显示\r\n   */\r\n  onShow () {\r\n    // TODO: onShow\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面隐藏\r\n   */\r\n  onHide () {\r\n    // TODO: onHide\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面卸载\r\n   */\r\n  onUnload () {\r\n    // TODO: onUnload\r\n  },\r\n\r\n  /**\r\n   * 页面相关事件处理函数--监听用户下拉动作\r\n   */\r\n  onPullDownRefresh () {\r\n    // TODO: onPullDownRefresh\r\n  }\r\n})\r\n"]}